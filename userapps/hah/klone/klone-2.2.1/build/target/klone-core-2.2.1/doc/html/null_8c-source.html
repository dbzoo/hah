<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KLone: null.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>null.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 2005, 2006 by KoanLogic s.r.l. &lt;http://www.koanlogic.com&gt;</span>
00003 <span class="comment"> * All rights reserved.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * This file is part of KLone, and as such it is subject to the license stated</span>
00006 <span class="comment"> * in the LICENSE file which you have received as part of this distribution.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * $Id: null.c,v 1.15 2007/10/26 08:57:59 tho Exp $</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#include "klone_conf.h"</span>
00012 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00013 <span class="preprocessor">#include &lt;klone/codec.h&gt;</span>
00014 <span class="preprocessor">#include &lt;klone/cnull.h&gt;</span>
00015 <span class="preprocessor">#include &lt;klone/utils.h&gt;</span>
00016 
00017 
00018 <span class="keyword">struct </span>codec_null_s
00019 {
00020     codec_t codec;
00021 };
00022 
00023 <span class="keyword">typedef</span> <span class="keyword">struct </span>codec_null_s codec_null_t;
00024 
00025 <span class="keyword">static</span> ssize_t null_flush(codec_t *cn, <span class="keywordtype">char</span> *dst, size_t *dcount)
00026 {
00027     u_unused_args(cn, dst);
00028     *dcount = 0;
00029     <span class="keywordflow">return</span> CODEC_FLUSH_COMPLETE;
00030 }
00031 
00032 <span class="keyword">static</span> ssize_t null_transform(codec_t *cn, <span class="keywordtype">char</span> *dst, size_t *dcount, 
00033         <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t src_sz)
00034 {
00035     ssize_t wr;
00036     
00037     dbg_err_if (src == NULL);
00038     dbg_err_if (dst == NULL);
00039     dbg_err_if (dcount == NULL || *dcount == 0);
00040     dbg_err_if (src_sz == 0);
00041 
00042     u_unused_args(cn);
00043 
00044     wr = MIN(src_sz, *dcount); 
00045     memcpy(dst, src, wr);
00046     *dcount = wr;
00047 
00048     dbg_err_if(wr == 0);
00049     <span class="keywordflow">return</span> wr;
00050 err:
00051     <span class="keywordflow">return</span> -1;
00052 }
00053 
00054 <span class="keyword">static</span> <span class="keywordtype">int</span> null_free(codec_t *cn)
00055 {
00056     U_FREE(cn);
00057 
00058     <span class="keywordflow">return</span> 0;
00059 }
00060 
<a name="l00075"></a><a class="code" href="group__filters.html#ga0">00075</a> <span class="keywordtype">int</span> <a class="code" href="group__filters.html#ga0">codec_null_create</a>(codec_t **pcn)
00076 {
00077     codec_null_t *cn = NULL;
00078 
00079     dbg_return_if (pcn == NULL, ~0);
00080 
00081     cn = u_zalloc(<span class="keyword">sizeof</span>(codec_null_t));
00082     dbg_err_if(cn == NULL);
00083 
00084     cn-&gt;codec.transform = null_transform;
00085     cn-&gt;codec.flush = null_flush;
00086     cn-&gt;codec.free = null_free;      
00087 
00088     *pcn = (codec_t*)cn;
00089 
00090     <span class="keywordflow">return</span> 0;
00091 err:
00092     U_FREE(cn);
00093     <span class="keywordflow">return</span> ~0;
00094 }
00095 
</pre></div>
    </div>

    <div id="footer">
        <p>Copyright &copy; 
    2005-2007 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
         | Valid <a
        href="http://jigsaw.w3.org/css-validator/">CSS</a> &amp; <a
        href="http://validator.w3.org/">XHTML</a> | powered by <a
        href="/klone/index.html">KLone</a> </p>
    </div>
</body>

</html>


