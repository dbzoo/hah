<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: list.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>list.c</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;string.h&gt;</span>
00002 <span class="preprocessor">#include &lt;syslog.h&gt;</span>
00003 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00004 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00005 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00006 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00007 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00008 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00009 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00010 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00011 
00012 <a class="code" href="group__test.html#ga10">U_TEST_MODULE</a>(list);
00013 
00014 <span class="keyword">static</span> <span class="keywordtype">int</span> test_list_iterator(<span class="keywordtype">void</span>)
00015 {
00016     <span class="keyword">enum</span> { ITERS = 300 };
00017     u_list_t *l = NULL;
00018     <span class="keywordtype">int</span> i, tot0, tot1;
00019     <span class="keywordtype">void</span> *it;
00020     <span class="keywordtype">int</span> v;
00021 
00022     con_err_if(<a class="code" href="group__list.html#ga0">u_list_create</a>(&amp;l));
00023     
00024     u_list_foreach(l, v, it)
00025     {
00026         con_err(<span class="stringliteral">"expecting no items!"</span>);
00027     }
00028 
00029     tot0 = 0;
00030     <span class="keywordflow">for</span>(i = 1; i &lt; ITERS; ++i)
00031     {
00032         con_err_if(<a class="code" href="group__list.html#ga2">u_list_add</a>(l, (<span class="keywordtype">void</span>*)i));
00033         tot0 += i;
00034     }
00035 
00036     <span class="keywordflow">for</span>(i = 1; i &lt; ITERS; ++i)
00037     {
00038         con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)i, i));
00039         tot0 += i;
00040     }
00041 
00042     tot1 = 0;
00043     u_list_foreach(l, v, it)
00044         tot1 += v;
00045 
00046     con_err_if(tot0 != tot1);
00047 
00048     <span class="comment">/* remove some items */</span>
00049     size_t c = <a class="code" href="group__list.html#ga4">u_list_count</a>(l)/2;
00050     <span class="keywordflow">for</span>(i = 0; i &lt; c; ++i)
00051     {
00052         <a class="code" href="group__list.html#ga9">u_list_del_n</a>(l, 0, (<span class="keywordtype">void</span>*)&amp;v);
00053         tot0 -= v;
00054     }
00055 
00056     tot1 = 0;
00057     u_list_foreach(l, v, it)
00058         tot1 += v;
00059     con_err_if(tot0 != tot1);
00060 
00061     <a class="code" href="group__list.html#ga1">u_list_free</a>(l);
00062 
00063     <span class="keywordflow">return</span> 0;
00064 err:
00065     <span class="keywordflow">return</span> ~0;
00066 }
00067 
00068 <span class="keyword">static</span> <span class="keywordtype">int</span> test_list_ins (<span class="keywordtype">void</span>)
00069 {
00070     <span class="keyword">enum</span> { ITERS = 3 };
00071     u_list_t *l = NULL;
00072     <span class="keywordtype">int</span> i;
00073     <span class="keywordtype">void</span>* prev;
00074 
00075     con_err_if(<a class="code" href="group__list.html#ga0">u_list_create</a>(&amp;l));
00076     con_err_if(<a class="code" href="group__list.html#ga2">u_list_add</a>(l, (<span class="keywordtype">void</span>*)1));
00077     con_err_if(<a class="code" href="group__list.html#ga2">u_list_add</a>(l, (<span class="keywordtype">void</span>*)2));
00078     con_err_if(<a class="code" href="group__list.html#ga2">u_list_add</a>(l, (<span class="keywordtype">void</span>*)99));
00079     con_err_if(<a class="code" href="group__list.html#ga2">u_list_add</a>(l, (<span class="keywordtype">void</span>*)2));
00080     con_err_if(<a class="code" href="group__list.html#ga2">u_list_add</a>(l, (<span class="keywordtype">void</span>*)4));
00081 
00082     con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)0, 0));
00083     con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)3, 3));
00084     con_err_if(<a class="code" href="group__list.html#ga3">u_list_del</a>(l, (<span class="keywordtype">void</span>*)99));
00085     con_err_if(<a class="code" href="group__list.html#ga9">u_list_del_n</a>(l, 4, NULL));
00086 
00087     con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)99, 0));
00088     con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)99, <a class="code" href="group__list.html#ga4">u_list_count</a>(l)));
00089 
00090     con_err_if(<a class="code" href="group__list.html#ga9">u_list_del_n</a>(l, 0, &amp;prev));
00091     con_err_if((<span class="keywordtype">int</span>)prev != 99);
00092 
00093     con_err_if(<a class="code" href="group__list.html#ga9">u_list_del_n</a>(l, <a class="code" href="group__list.html#ga4">u_list_count</a>(l)-1, &amp;prev));
00094     con_err_if((<span class="keywordtype">int</span>)prev != 99);
00095 
00096     <span class="keywordflow">for</span>(i = 0; i &lt; ITERS; ++i)
00097         con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)99, 2));
00098     <span class="keywordflow">for</span>(i = 0; i &lt; ITERS; ++i)
00099         con_err_if(<a class="code" href="group__list.html#ga3">u_list_del</a>(l, (<span class="keywordtype">void</span>*)99));
00100 
00101     <span class="keywordflow">for</span>(i = 0; i &lt; ITERS; ++i)
00102         con_err_if(<a class="code" href="group__list.html#ga6">u_list_insert</a>(l, (<span class="keywordtype">void</span>*)99, 2));
00103 
00104     <span class="keywordflow">for</span>(i = 0; i &lt; ITERS; ++i)
00105     {
00106         con_err_if(<a class="code" href="group__list.html#ga9">u_list_del_n</a>(l, 2, &amp;prev));
00107         con_err_if((<span class="keywordtype">int</span>)prev != 99);
00108     }
00109 
00110     <span class="keywordflow">for</span>(i = 0; i &lt; <a class="code" href="group__list.html#ga4">u_list_count</a>(l); ++i)
00111         con_err_if(i != (<span class="keywordtype">int</span>)<a class="code" href="group__list.html#ga5">u_list_get_n</a>(l, i));
00112 
00113     <a class="code" href="group__list.html#ga1">u_list_free</a>(l);
00114 
00115     <span class="keywordflow">return</span> 0;
00116 err:
00117     <span class="keywordflow">return</span> ~0;
00118 }
00119 
00120 <a class="code" href="group__test.html#ga10">U_TEST_MODULE</a>( list )
00121 {
00122     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_list_ins );
00123     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_list_iterator );
00124 
00125     <span class="keywordflow">return</span> 0;                                                
00126 }
</pre></div><hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
