<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KLone: response.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>response.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 2005, 2006 by KoanLogic s.r.l. &lt;http://www.koanlogic.com&gt;</span>
00003 <span class="comment"> * All rights reserved.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * This file is part of KLone, and as such it is subject to the license stated</span>
00006 <span class="comment"> * in the LICENSE file which you have received as part of this distribution.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * $Id: response.c,v 1.30 2008/07/25 09:38:56 tho Exp $</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#include "klone_conf.h"</span>
00012 <span class="preprocessor">#include &lt;time.h&gt;</span>
00013 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00014 <span class="preprocessor">#include &lt;<a class="code" href="response_8h.html">klone/response.h</a>&gt;</span>
00015 <span class="preprocessor">#include &lt;klone/utils.h&gt;</span>
00016 <span class="preprocessor">#include &lt;klone/io.h&gt;</span>
00017 <span class="preprocessor">#include &lt;klone/codec.h&gt;</span>
00018 <span class="preprocessor">#include &lt;<a class="code" href="http_8h.html">klone/http.h</a>&gt;</span>
00019 <span class="preprocessor">#include &lt;klone/rsfilter.h&gt;</span>
00020 
00021 <span class="keyword">struct </span>response_s
00022 {
00023     http_t *http;           <span class="comment">/* http server handle               */</span>
00024     header_t *header;       <span class="comment">/* output header                    */</span>
00025     io_t *io;               <span class="comment">/* output stream                    */</span>
00026     <span class="keywordtype">int</span> status;             <span class="comment">/* http status code                 */</span>
00027     <span class="keywordtype">int</span> method;             <span class="comment">/* HTTP request method              */</span>
00028     <span class="keywordtype">int</span> cgi;                <span class="comment">/* if we're running in cgi context  */</span>
00029 };
00030 
<a name="l00044"></a><a class="code" href="group__response.html#ga23">00044</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga23">response_set_content_encoding</a>(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *encoding)
00045 {
00046     dbg_err_if(encoding == NULL);
00047 
00048     dbg_err_if(header_set_field(rs-&gt;header, <span class="stringliteral">"Content-Encoding"</span>, encoding));
00049 
00050     <span class="keywordflow">return</span> 0;
00051 err:
00052     <span class="keywordflow">return</span> ~0;
00053 }
00054 
<a name="l00074"></a><a class="code" href="group__response.html#ga11">00074</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga11">response_disable_caching</a>(response_t *rs)
00075 {
00076     dbg_err_if(<a class="code" href="group__response.html#ga20">response_set_field</a>(rs, <span class="stringliteral">"Cache-Control"</span>, 
00077         <span class="stringliteral">"no-cache, must-revalidate"</span>));
00078 
00079     dbg_err_if(<a class="code" href="group__response.html#ga20">response_set_field</a>(rs, <span class="stringliteral">"Expires"</span>, 
00080         <span class="stringliteral">"Mon, 1 Jan 1990 05:00:00 GMT"</span>));
00081 
00082     dbg_err_if(<a class="code" href="group__response.html#ga20">response_set_field</a>(rs, <span class="stringliteral">"Pragma"</span>, <span class="stringliteral">"no-cache"</span>));
00083 
00084     <span class="keywordflow">return</span> 0;
00085 err:
00086     <span class="keywordflow">return</span> ~0;
00087 }
00088 
<a name="l00108"></a><a class="code" href="group__response.html#ga10">00108</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga10">response_enable_caching</a>(response_t *rs)
00109 {
00110     dbg_err_if(<a class="code" href="group__response.html#ga8">response_del_field</a>(rs, <span class="stringliteral">"Cache-Control"</span>));
00111 
00112     dbg_err_if(<a class="code" href="group__response.html#ga8">response_del_field</a>(rs, <span class="stringliteral">"Expires"</span>));
00113 
00114     dbg_err_if(<a class="code" href="group__response.html#ga8">response_del_field</a>(rs, <span class="stringliteral">"Pragma"</span>));
00115 
00116     <span class="keywordflow">return</span> 0;
00117 err:
00118     <span class="keywordflow">return</span> ~0;
00119 }
00120 
<a name="l00140"></a><a class="code" href="group__response.html#ga26">00140</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga26">response_set_cookie</a>(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value,
00141     time_t expire, <span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *domain, <span class="keywordtype">int</span> secure)
00142 {
00143     <span class="keyword">enum</span> { BUFSZ = 4096, DATESZ = 64 };
00144     field_t *field = NULL;
00145     <span class="keywordtype">char</span> buf[BUFSZ], date[DATESZ];
00146 
00147     <span class="keywordflow">if</span>(value == NULL)
00148     {   <span class="comment">/* delete this cookie */</span>
00149         dbg_err_if(u_snprintf(buf, BUFSZ, 
00150             <span class="stringliteral">"%s=; expires=Wed, 01-Jan-1990 10:10:10 GMT"</span>, name));
00151     } <span class="keywordflow">else</span> {
00152         <span class="comment">/* name */</span>
00153         dbg_err_if(u_snprintf(buf, BUFSZ, <span class="stringliteral">"%s="</span>, name));
00154 
00155         <span class="comment">/* encoded value */</span>
00156         dbg_err_if(<a class="code" href="group__ut.html#ga30">u_urlncpy</a>(buf + strlen(buf), value, strlen(value), 
00157             URLCPY_ENCODE) &lt;= 0);
00158 
00159         <span class="comment">/* expiration date */</span>
00160         <span class="keywordflow">if</span>(expire)
00161         {
00162             dbg_err_if(<a class="code" href="group__ut.html#ga50">u_tt_to_rfc822</a>(date, expire));
00163 
00164             dbg_err_if(u_snprintf(buf + strlen(buf), BUFSZ - strlen(buf), 
00165                         <span class="stringliteral">"; expires=%s"</span>, date));
00166         }
00167 
00168         <span class="comment">/* path */</span>
00169         <span class="keywordflow">if</span>(path)
00170             dbg_err_if(u_snprintf(buf + strlen(buf), 
00171                         BUFSZ - strlen(buf), <span class="stringliteral">"; path=%s"</span>, path));
00172 
00173         <span class="comment">/* domain */</span>
00174         <span class="keywordflow">if</span>(domain)
00175             dbg_err_if(u_snprintf(buf + strlen(buf), 
00176                         BUFSZ - strlen(buf), <span class="stringliteral">"; domain=%s"</span>, domain));
00177         <span class="comment">/* secure flag */</span>
00178         <span class="keywordflow">if</span>(secure)
00179             dbg_err_if(u_snprintf(buf + strlen(buf), 
00180                         BUFSZ - strlen(buf), <span class="stringliteral">"; secure"</span>));
00181 
00182     }
00183 
00184     dbg_err_if(field_create(<span class="stringliteral">"Set-Cookie"</span>, buf, &amp;field));
00185 
00186     dbg_err_if(header_add_field(rs-&gt;header, field));
00187 
00188     <span class="keywordflow">return</span> 0;
00189 err:
00190     <span class="keywordflow">if</span>(field)
00191         field_free(field);
00192     <span class="keywordflow">return</span> ~0;
00193 }
00194 
00195 <span class="comment">/*</span>
00196 <span class="comment"> * \ingroup response</span>
00197 <span class="comment"> * \brief   Print the status of a response object.</span>
00198 <span class="comment"> *</span>
00199 <span class="comment"> * A string representing the status of a response object \p rs is printed to \p</span>
00200 <span class="comment"> * io. </span>
00201 <span class="comment"> *</span>
00202 <span class="comment"> * \param rs      response object</span>
00203 <span class="comment"> * \param io      output I/O object</span>
00204 <span class="comment"> *</span>
00205 <span class="comment"> * \return</span>
00206 <span class="comment"> *  - \c 0 if successful</span>
00207 <span class="comment"> *  - \c ~0 on error</span>
00208 <span class="comment"> */</span>
00209 <span class="keyword">static</span> <span class="keywordtype">int</span> response_print_status(response_t *rs, io_t *io)
00210 {
00211     dbg_err_if(<a class="code" href="group__basic.html#ga28">io_printf</a>(io, <span class="stringliteral">"HTTP/1.0 %d %s\r\n"</span>, rs-&gt;status, 
00212         http_get_status_desc(rs-&gt;status)) &lt; 0);
00213 
00214     <span class="keywordflow">return</span> 0;
00215 err:
00216     <span class="keywordflow">return</span> ~0;
00217 }
00218 
00219 <span class="comment">/*</span>
00220 <span class="comment"> * \ingroup response</span>
00221 <span class="comment"> * \brief   Print a response field.</span>
00222 <span class="comment"> *</span>
00223 <span class="comment"> * Print the name and value of a \p field of \p response to \p io.</span>
00224 <span class="comment"> *</span>
00225 <span class="comment"> * \param rs      response object</span>
00226 <span class="comment"> * \param io      output I/O object</span>
00227 <span class="comment"> * \param field   field to be printed</span>
00228 <span class="comment"> *</span>
00229 <span class="comment"> * \return</span>
00230 <span class="comment"> *  - \c 0 if successful</span>
00231 <span class="comment"> *  - \c ~0 on error</span>
00232 <span class="comment"> */</span>
00233 <span class="keyword">static</span> <span class="keywordtype">int</span> response_print_field(response_t *rs, io_t *io, field_t *field)
00234 {
00235     u_unused_args(rs);
00236 
00237     dbg_err_if(<a class="code" href="group__basic.html#ga28">io_printf</a>(io, <span class="stringliteral">"%s: %s\r\n"</span>, field-&gt;name, field-&gt;value) &lt; 0);
00238     
00239     <span class="keywordflow">return</span> 0;
00240 err:
00241     <span class="keywordflow">return</span> ~0;
00242 }
00243 
<a name="l00257"></a><a class="code" href="group__response.html#ga8">00257</a> <span class="keywordtype">void</span> <a class="code" href="group__response.html#ga8">response_set_method</a>(response_t *rs, <span class="keywordtype">int</span> method)
00258 {
00259     rs-&gt;method = method;
00260 }
00261 
<a name="l00274"></a><a class="code" href="group__response.html#ga9">00274</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga9">response_get_method</a>(response_t *rs)
00275 {
00276     <span class="keywordflow">return</span> rs-&gt;method;
00277 }
00278 
00279 
00280 <span class="comment">/* set is-cgi flag */</span>
00281 <span class="keywordtype">void</span> response_set_cgi(response_t *rs, <span class="keywordtype">int</span> cgi)
00282 {
00283     rs-&gt;cgi = cgi;
00284     <span class="keywordflow">return</span> ;
00285 }
00286 
00287 <span class="comment">/* calculate the approx max value of the current header (useful to alloc a</span>
00288 <span class="comment"> * buffer big enough) */</span>
00289 size_t response_get_max_header_size(response_t *rs)
00290 {
00291     field_t *field;
00292     <span class="keywordtype">int</span> i, n;
00293     size_t sz = 0;
00294 
00295     <span class="comment">/* calc status line length */</span>
00296     sz += 16; <span class="comment">/* http/x.y nnn[n] \r\n */</span>
00297     sz += strlen(http_get_status_desc(rs-&gt;status));
00298 
00299     n = header_field_count(rs-&gt;header);
00300     <span class="keywordflow">for</span>(i = 0; i &lt; n; ++i)
00301     {
00302         <span class="keyword">const</span> <span class="keywordtype">char</span> *p;
00303 
00304         field =  header_get_fieldn(rs-&gt;header, i);
00305         sz += ((p = field_get_name(field)) != NULL) ? strlen(p) : 0;
00306         sz += ((p = field_get_value(field)) != NULL) ? strlen(p) : 0;
00307         sz += 4; <span class="comment">/* blanks and new lines */</span>
00308     }
00309 
00310     sz += 2; <span class="comment">/* final \r\n */</span>
00311     sz += 64; <span class="comment">/* guard bytes */</span>
00312 
00313     <span class="keywordflow">return</span> sz;
00314 }
00315 
00316 <span class="comment">/* </span>
00317 <span class="comment"> * \ingroup response</span>
00318 <span class="comment"> * \brief   Output a response header </span>
00319 <span class="comment"> *</span>
00320 <span class="comment"> * Print the header of \p rs to \p io.</span>
00321 <span class="comment"> *</span>
00322 <span class="comment"> * \param rs        response object</span>
00323 <span class="comment"> * \param io        output I/O object</span>
00324 <span class="comment"> * </span>
00325 <span class="comment"> * \return</span>
00326 <span class="comment"> *  - \c 0 if successful</span>
00327 <span class="comment"> *  - \c ~0 on error</span>
00328 <span class="comment"> */</span>
00329 <span class="keywordtype">int</span> response_print_header_to_io(response_t *rs, io_t *io)
00330 {
00331     <span class="keywordtype">int</span> i, n;
00332 
00333     dbg_err_if(io == NULL);
00334 
00335     <span class="comment">/* print status line */</span>
00336     <span class="keywordflow">if</span>(!rs-&gt;cgi)
00337         dbg_err_if(response_print_status(rs, io));
00338 
00339     <span class="comment">/* print field list */</span>
00340     n = header_field_count(rs-&gt;header);
00341     <span class="keywordflow">for</span>(i = 0; i &lt; n; ++i)
00342         dbg_err_if(response_print_field(rs, io,
00343             header_get_fieldn(rs-&gt;header, i)));
00344 
00345     dbg_err_if(<a class="code" href="group__basic.html#ga28">io_printf</a>(io, <span class="stringliteral">"\r\n"</span>) &lt; 0);
00346 
00347     <span class="keywordflow">return</span> 0;
00348 err:
00349     <span class="keywordflow">return</span> ~0;
00350 }
00351 
<a name="l00364"></a><a class="code" href="group__response.html#ga13">00364</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga13">response_print_header</a>(response_t *rs)
00365 {
00366     <span class="keywordflow">return</span> response_print_header_to_io(rs, rs-&gt;io);
00367 }
00368 
00369 
<a name="l00384"></a><a class="code" href="group__response.html#ga20">00384</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga20">response_set_field</a>(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
00385 {
00386     <span class="keywordflow">return</span> header_set_field(rs-&gt;header, name, value);
00387 }
00388 
00389 
<a name="l00403"></a><a class="code" href="group__response.html#ga8">00403</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga8">response_del_field</a>(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00404 {
00405     field_t *f = NULL;
00406     
00407     f = header_get_field(rs-&gt;header, name);
00408     dbg_err_if(f == NULL);
00409 
00410     <span class="comment">/* field found, delete it */</span>
00411     dbg_err_if(header_del_field(rs-&gt;header, f));
00412 
00413     field_free(f);
00414 
00415     <span class="keywordflow">return</span> 0;
00416 err:
00417     <span class="keywordflow">return</span> ~0;
00418 }
00419 
<a name="l00433"></a><a class="code" href="group__response.html#ga21">00433</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga21">response_set_content_type</a>(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *mime_type)
00434 {
00435     dbg_err_if(mime_type == NULL);
00436 
00437     dbg_err_if(header_set_field(rs-&gt;header, <span class="stringliteral">"Content-Type"</span>, mime_type));
00438 
00439     <span class="keywordflow">return</span> 0;
00440 err:
00441     <span class="keywordflow">return</span> ~0;
00442 }
00443 
<a name="l00457"></a><a class="code" href="group__response.html#ga25">00457</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga25">response_set_date</a>(response_t *rs, time_t date)
00458 {
00459     <span class="keyword">enum</span> { BUFSZ = 64 };
00460     <span class="keywordtype">char</span> buf[BUFSZ];
00461 
00462     dbg_err_if(<a class="code" href="group__ut.html#ga50">u_tt_to_rfc822</a>(buf, date));
00463 
00464     dbg_err_if(header_set_field(rs-&gt;header, <span class="stringliteral">"Date"</span>, buf));
00465 
00466     <span class="keywordflow">return</span> 0;
00467 err:
00468     <span class="keywordflow">return</span> ~0;
00469 }
00470 
<a name="l00484"></a><a class="code" href="group__response.html#ga24">00484</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga24">response_set_last_modified</a>(response_t *rs, time_t mtime)
00485 {
00486     <span class="keyword">enum</span> { BUFSZ = 64 };
00487     <span class="keywordtype">char</span> buf[BUFSZ];
00488 
00489     dbg_err_if(<a class="code" href="group__ut.html#ga50">u_tt_to_rfc822</a>(buf, mtime));
00490 
00491     dbg_err_if(header_set_field(rs-&gt;header, <span class="stringliteral">"Last-Modified"</span>, buf));
00492 
00493     <span class="keywordflow">return</span> 0;
00494 err:
00495     <span class="keywordflow">return</span> ~0;
00496 }
00497 
<a name="l00511"></a><a class="code" href="group__response.html#ga22">00511</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga22">response_set_content_length</a>(response_t *rs, size_t sz)
00512 {
00513     <span class="keyword">enum</span> { BUFSZ = 64 };
00514     <span class="keywordtype">char</span> buf[BUFSZ];
00515 
00516     dbg_err_if(u_snprintf(buf, BUFSZ, <span class="stringliteral">"%u"</span>, sz));
00517 
00518     dbg_err_if(header_set_field(rs-&gt;header, <span class="stringliteral">"Content-Length"</span>, buf));
00519 
00520     <span class="keywordflow">return</span> 0;
00521 err:
00522     <span class="keywordflow">return</span> ~0;
00523 }
00524 
<a name="l00537"></a><a class="code" href="group__response.html#ga7">00537</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga7">response_get_status</a>(response_t *rs)
00538 {
00539     <span class="keywordflow">return</span> rs-&gt;status;
00540 }
00541 
<a name="l00553"></a><a class="code" href="group__response.html#ga17">00553</a> header_t* <a class="code" href="group__response.html#ga17">response_get_header</a>(response_t *rs)
00554 {
00555     <span class="keywordflow">return</span> rs-&gt;header;
00556 }
00557 
<a name="l00569"></a><a class="code" href="group__response.html#ga16">00569</a> io_t* <a class="code" href="group__response.html#ga16">response_io</a>(response_t *rs)
00570 {
00571     <span class="keywordflow">return</span> rs-&gt;io;
00572 }
00573 
<a name="l00587"></a><a class="code" href="group__response.html#ga5">00587</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga5">response_redirect</a>(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *url)
00588 {
00589     field_t *field;
00590 
00591     <span class="comment">/* send Location: with redirect status code */</span>
00592     <a class="code" href="group__response.html#ga6">response_set_status</a>(rs, <a class="code" href="http_8h.html#a32a7">HTTP_STATUS_MOVED_TEMPORARILY</a>);
00593 
00594     dbg_err_if(field_create(<span class="stringliteral">"Location"</span>, url, &amp;field));
00595 
00596     header_add_field(rs-&gt;header, field); 
00597 
00598     <span class="keywordflow">return</span> 0;
00599 err:
00600     <span class="keywordflow">return</span> ~0;
00601 }
00602 
<a name="l00616"></a><a class="code" href="group__response.html#ga6">00616</a> <span class="keywordtype">int</span> <a class="code" href="group__response.html#ga6">response_set_status</a>(response_t *rs, <span class="keywordtype">int</span> status)
00617 {
00618     rs-&gt;status = status;
00619 
00620     <span class="keywordflow">return</span> 0;
00621 }
00622 
00623 <span class="comment">/*</span>
00624 <span class="comment"> * \ingroup response</span>
00625 <span class="comment"> * \brief   Bind the response to a given I/O object</span>
00626 <span class="comment"> *  </span>
00627 <span class="comment"> * Bind response \p rs to I/O object \p out.</span>
00628 <span class="comment"> *</span>
00629 <span class="comment"> * \param rs     </span>
00630 <span class="comment"> * \param out  output I/O object</span>
00631 <span class="comment"> *  </span>
00632 <span class="comment"> * \return</span>
00633 <span class="comment"> *  - \c 0  always</span>
00634 <span class="comment"> */</span>
00635 <span class="keywordtype">int</span> response_bind(response_t *rs, io_t *out)
00636 {
00637     rs-&gt;io = out;
00638 
00639     <span class="keywordflow">return</span> 0;
00640 }
00641 
00642 <span class="comment">/*</span>
00643 <span class="comment"> * \ingroup response</span>
00644 <span class="comment"> * \brief   Create a response object</span>
00645 <span class="comment"> *  </span>
00646 <span class="comment"> * \param http  parameter \p http description</span>
00647 <span class="comment"> * \param prs   parameter \p prs description</span>
00648 <span class="comment"> *  </span>
00649 <span class="comment"> * \return</span>
00650 <span class="comment"> *  - \c 0  if successful</span>
00651 <span class="comment"> *  - \c ~0 on error</span>
00652 <span class="comment"> */</span>
00653 <span class="keywordtype">int</span> response_create(http_t *http, response_t **prs)
00654 {
00655     response_t *rs = NULL;
00656 
00657     rs = u_zalloc(<span class="keyword">sizeof</span>(response_t));
00658     dbg_err_if(rs == NULL);
00659 
00660     dbg_err_if(header_create(&amp;rs-&gt;header));
00661 
00662     rs-&gt;http = http;
00663 
00664     *prs = rs;
00665 
00666     <span class="keywordflow">return</span> 0;
00667 err:
00668     <span class="keywordflow">if</span>(rs-&gt;header)
00669         header_free(rs-&gt;header);
00670     <span class="keywordflow">if</span>(rs)
00671         response_free(rs);
00672     <span class="keywordflow">return</span> ~0;
00673 }
00674 
00675 <span class="comment">/*</span>
00676 <span class="comment"> * \ingroup response</span>
00677 <span class="comment"> * \brief   Free a response object</span>
00678 <span class="comment"> *  </span>
00679 <span class="comment"> * \param rs response object</span>
00680 <span class="comment"> *  </span>
00681 <span class="comment"> * \return</span>
00682 <span class="comment"> *  - \c 0  always</span>
00683 <span class="comment"> */</span>
00684 <span class="keywordtype">int</span> response_free(response_t *rs)
00685 {
00686     <span class="keywordflow">if</span>(rs-&gt;io)
00687         <a class="code" href="group__basic.html#ga14">io_free</a>(rs-&gt;io);
00688 
00689     <span class="keywordflow">if</span>(rs-&gt;header)
00690         header_free(rs-&gt;header);
00691 
00692     U_FREE(rs);
00693 
00694     <span class="keywordflow">return</span> 0;
00695 }
00696 
00697 
00698 <span class="comment">/* return a field obj of the field named 'name' or NULL if the field does not </span>
00699 <span class="comment">   exist */</span>
00700 field_t* response_get_field(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00701 {
00702     dbg_return_if (rs == NULL, NULL);
00703     dbg_return_if (name == NULL, NULL);
00704 
00705     <span class="keywordflow">return</span> header_get_field(rs-&gt;header, name);
00706 }
00707 
00708 <span class="comment">/* return the string value of the field named 'name' or NULL if the field does</span>
00709 <span class="comment">   not exist */</span>
00710 <span class="keyword">const</span> <span class="keywordtype">char</span>* response_get_field_value(response_t *rs, <span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00711 {
00712     dbg_return_if (rs == NULL, NULL);
00713     dbg_return_if (name == NULL, NULL);
00714 
00715     <span class="keywordflow">return</span> header_get_field_value(rs-&gt;header, name);
00716 }
</pre></div>
    </div>

    <div id="footer">
        <p>Copyright &copy; 
    2005-2007 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
         | Valid <a
        href="http://jigsaw.w3.org/css-validator/">CSS</a> &amp; <a
        href="http://validator.w3.org/">XHTML</a> | powered by <a
        href="/klone/index.html">KLone</a> </p>
    </div>
</body>

</html>


