<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KLone: field.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>field.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 2005, 2006 by KoanLogic s.r.l. &lt;http://www.koanlogic.com&gt;</span>
00003 <span class="comment"> * All rights reserved.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * This file is part of KLone, and as such it is subject to the license stated</span>
00006 <span class="comment"> * in the LICENSE file which you have received as part of this distribution.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * $Id: field.c,v 1.14 2007/10/26 08:57:59 tho Exp $</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#include "klone_conf.h"</span>
00012 <span class="preprocessor">#include &lt;string.h&gt;</span>
00013 <span class="preprocessor">#include &lt;klone/field.h&gt;</span>
00014 <span class="preprocessor">#include &lt;klone/utils.h&gt;</span>
00015 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00016 
00017 <span class="keywordtype">int</span> field_set(field_t*, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value);
00018 <span class="keywordtype">int</span> field_set_from_line(field_t*, <span class="keyword">const</span> <span class="keywordtype">char</span> *line);
00019 <span class="keyword">const</span> <span class="keywordtype">char</span>* field_get_name(field_t *f);
00020 <span class="keyword">const</span> <span class="keywordtype">char</span>* field_get_value(field_t *f);
00021 
00034 <span class="keywordtype">int</span> field_set(field_t *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value)
00035 {
00036     <span class="keywordtype">char</span> *n = NULL, *v = NULL;
00037 
00038     dbg_err_if (f == NULL);
00039     dbg_err_if (name == NULL);
00040     dbg_err_if (value == NULL);
00041 
00042     n = u_strdup(name);
00043     dbg_err_if(n == NULL);
00044 
00045     v = u_strdup(value);
00046     dbg_err_if(v == NULL);
00047 
00048     U_FREE(f-&gt;name);
00049     U_FREE(f-&gt;value);
00050 
00051     f-&gt;name = n;
00052     f-&gt;value = v;
00053 
00054     <span class="keywordflow">return</span> 0;
00055 err:
00056     U_FREE(n);
00057     U_FREE(v);
00058 
00059     <span class="keywordflow">return</span> ~0;
00060 }
00061 
00074 <span class="keywordtype">int</span> field_set_from_line(field_t *f, <span class="keyword">const</span> <span class="keywordtype">char</span> *ln)
00075 {
00076     <span class="keyword">enum</span> { BUFSZ = 256 };
00077     <span class="keywordtype">char</span> *p, *name = NULL;
00078 
00079     dbg_err_if (f == NULL);
00080     dbg_err_if (ln == NULL);
00081     dbg_err_if (!strlen(ln));
00082 
00083     dbg_err_if((p = strchr(ln, <span class="charliteral">':'</span>)) == NULL);
00084 
00085     name = u_strndup(ln, p-ln);
00086     dbg_err_if(name == NULL);
00087 
00088     <span class="comment">/* eat blanks between ':' and value */</span>
00089     <span class="keywordflow">for</span>(++p; u_isblank(*p); ++p)
00090         ;
00091 
00092     dbg_err_if(field_set(f, name, p));
00093 
00094     U_FREE(name);
00095 
00096     <span class="keywordflow">return</span> 0;
00097 err:
00098     U_FREE(name);
00099     <span class="keywordflow">return</span> ~0;
00100 }
00101 
00112 <span class="keyword">const</span> <span class="keywordtype">char</span>* field_get_name(field_t *f)
00113 {
00114     dbg_return_if (f == NULL, NULL);
00115 
00116     <span class="keywordflow">return</span> f-&gt;name; <span class="comment">/* may be null */</span>
00117 }
00118 
00129 <span class="keyword">const</span> <span class="keywordtype">char</span>* field_get_value(field_t *f)
00130 {
00131     dbg_return_if (f == NULL, NULL);
00132 
00133     <span class="keywordflow">return</span> f-&gt;value; <span class="comment">/* may be null */</span>
00134 }
00135 
00148 <span class="keywordtype">int</span> field_create(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keyword">const</span> <span class="keywordtype">char</span> *value, field_t **pf)
00149 {
00150     field_t *f = NULL;
00151 
00152     <span class="comment">/* name and value may be NULL */</span>
00153     dbg_err_if (pf == NULL);
00154 
00155     f = u_zalloc(<span class="keyword">sizeof</span>(field_t));
00156     dbg_err_if(f == NULL);
00157 
00158     <span class="keywordflow">if</span>(name)
00159         dbg_err_if((f-&gt;name = u_strdup(name)) == NULL);
00160 
00161     <span class="keywordflow">if</span>(value)
00162         dbg_err_if((f-&gt;value = u_strdup(value)) == NULL);
00163 
00164     *pf = f;
00165 
00166     <span class="keywordflow">return</span> 0;
00167 err:
00168     <span class="keywordflow">if</span>(f)
00169         field_free(f);
00170     <span class="keywordflow">return</span> ~0;
00171 }
00172 
00183 <span class="keywordtype">int</span> field_free(field_t *f)
00184 {
00185     <span class="keywordflow">if</span>(f)
00186     {
00187         U_FREE(f-&gt;name);
00188         U_FREE(f-&gt;value);
00189         U_FREE(f);
00190     }
00191 
00192     <span class="keywordflow">return</span> 0;
00193 }
</pre></div>
    </div>

    <div id="footer">
        <p>Copyright &copy; 
    2005-2007 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
         | Valid <a
        href="http://jigsaw.w3.org/css-validator/">CSS</a> &amp; <a
        href="http://validator.w3.org/">XHTML</a> | powered by <a
        href="/klone/index.html">KLone</a> </p>
    </div>
</body>

</html>


