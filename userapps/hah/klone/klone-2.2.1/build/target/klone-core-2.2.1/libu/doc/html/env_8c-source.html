<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: env.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>env.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 2005-2008 by KoanLogic s.r.l. - All rights reserved.</span>
00003 <span class="comment"> */</span>
00004 
00005 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00006 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00007 
00008 <span class="preprocessor">#include &lt;string.h&gt;</span>
00009 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00011 
00012 <span class="preprocessor">#include &lt;toolbox/env.h&gt;</span>
00013 <span class="preprocessor">#include &lt;toolbox/carpal.h&gt;</span>
00014 <span class="preprocessor">#include &lt;toolbox/misc.h&gt;</span>
00015 
<a name="l00037"></a><a class="code" href="group__env.html#ga0">00037</a> <span class="keywordtype">int</span> <a class="code" href="group__env.html#ga0">u_env_init</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *prefix, <span class="keyword">const</span> <span class="keywordtype">char</span> *cfile)
00038 {
00039     <span class="keyword">enum</span> { BUFSZ = 1024 };
00040     <span class="keyword">struct </span>stat sb;
00041     <span class="keywordtype">char</span> line[BUFSZ], pcmd[BUFSZ], *val;
00042     FILE *pi = NULL;
00043 
00044     dbg_return_if (cfile == NULL || prefix == NULL, ~0);
00045 
00046     <span class="comment">/* if 'cfile' does not exist bail out */</span>
00047     dbg_err_sifm (stat(cfile, &amp;sb) == -1, <span class="stringliteral">"%s"</span>, cfile);
00048 
00049     snprintf(pcmd, BUFSZ, <span class="stringliteral">". %s 2&gt;/dev/null &amp;&amp; env"</span>, cfile);
00050 
00051     dbg_err_if ((pi = popen(pcmd, <span class="stringliteral">"r"</span>)) == NULL);
00052 
00053     <span class="keywordflow">while</span>(fgets(line, BUFSZ-1, pi))
00054     {
00055         <span class="keywordflow">if</span>(strncmp(line, prefix, strlen(prefix)) == 0)
00056         {
00057             line[strlen(line)-1] = 0;
00058             val = strchr(line, <span class="charliteral">'='</span>);
00059             <span class="keywordflow">if</span>(!val)
00060                 <span class="keywordflow">continue</span>; <span class="comment">/* should never happen... */</span>
00061             *val++ = 0;
00062             <span class="comment">/* line is the name and val the value */</span>
00063             dbg_err_if(setenv(line, val, 1));
00064         }
00065     }
00066 
00067     pclose(pi);
00068     <span class="keywordflow">return</span> 0;
00069 
00070 err:
00071     U_PCLOSE(pi);
00072     <span class="keywordflow">return</span> ~0;
00073 }
00074 
<a name="l00085"></a><a class="code" href="group__env.html#ga1">00085</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="group__env.html#ga1">u_env_var</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *name)
00086 {
00087     <span class="keywordflow">return</span> getenv(name);
00088 }
00089 
</pre></div><hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
