<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: strtok_r.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>strtok_r.c</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 1998 Softweyr LLC.  All rights reserved.</span>
00003 <span class="comment"> *</span>
00004 <span class="comment"> * strtok_r, from Berkeley strtok</span>
00005 <span class="comment"> * Oct 13, 1998 by Wes Peters &lt;wes@softweyr.com&gt;</span>
00006 <span class="comment"> *</span>
00007 <span class="comment"> * Copyright (c) 1988, 1993</span>
00008 <span class="comment"> *    The Regents of the University of California.  All rights reserved.</span>
00009 <span class="comment"> *</span>
00010 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
00011 <span class="comment"> * modification, are permitted provided that the following conditions</span>
00012 <span class="comment"> * are met:</span>
00013 <span class="comment"> *</span>
00014 <span class="comment"> * 1. Redistributions of source code must retain the above copyright</span>
00015 <span class="comment"> *    notices, this list of conditions and the following disclaimer.</span>
00016 <span class="comment"> * </span>
00017 <span class="comment"> * 2. Redistributions in binary form must reproduce the above copyright</span>
00018 <span class="comment"> *    notices, this list of conditions and the following disclaimer in the</span>
00019 <span class="comment"> *    documentation and/or other materials provided with the distribution.</span>
00020 <span class="comment"> * </span>
00021 <span class="comment"> * 3. All advertising materials mentioning features or use of this software</span>
00022 <span class="comment"> *    must display the following acknowledgement:</span>
00023 <span class="comment"> *</span>
00024 <span class="comment"> *    This product includes software developed by Softweyr LLC, the</span>
00025 <span class="comment"> *      University of California, Berkeley, and its contributors.</span>
00026 <span class="comment"> *</span>
00027 <span class="comment"> * 4. Neither the name of the University nor the names of its contributors</span>
00028 <span class="comment"> *    may be used to endorse or promote products derived from this software</span>
00029 <span class="comment"> *    without specific prior written permission.</span>
00030 <span class="comment"> *</span>
00031 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY SOFTWEYR LLC, THE REGENTS AND CONTRIBUTORS</span>
00032 <span class="comment"> * ``AS IS'' AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
00033 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
00034 <span class="comment"> * PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL SOFTWEYR LLC, THE</span>
00035 <span class="comment"> * REGENTS, OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
00036 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED</span>
00037 <span class="comment"> * TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
00038 <span class="comment"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
00039 <span class="comment"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
00040 <span class="comment"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
00041 <span class="comment"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
00042 <span class="comment"> */</span>
00043 
00044 <span class="preprocessor">#include &lt;u/libu_conf.h&gt;</span>
00045 
00046 <span class="preprocessor">#ifndef HAVE_STRTOK_R</span>
00047 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stddef.h&gt;</span>
00048 <span class="preprocessor">#include &lt;string.h&gt;</span>
00049 
00050 <span class="keywordtype">char</span> *
00051 strtok_r(<span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *delim, <span class="keywordtype">char</span> **last)
00052 {
00053     <span class="keywordtype">char</span> *spanp;
00054     <span class="keywordtype">int</span> c, sc;
00055     <span class="keywordtype">char</span> *tok;
00056 
00057     <span class="keywordflow">if</span> (s == NULL &amp;&amp; (s = *last) == NULL)
00058     {
00059         <span class="keywordflow">return</span> NULL;
00060     }
00061 
00062     <span class="comment">/*</span>
00063 <span class="comment">     * Skip (span) leading delimiters (s += strspn(s, delim), sort of).</span>
00064 <span class="comment">     */</span>
00065 cont:
00066     c = *s++;
00067     <span class="keywordflow">for</span> (spanp = (<span class="keywordtype">char</span> *)delim; (sc = *spanp++) != 0; )
00068     {
00069         <span class="keywordflow">if</span> (c == sc)
00070         {
00071             <span class="keywordflow">goto</span> cont;
00072         }
00073     }
00074 
00075     <span class="keywordflow">if</span> (c == 0)        <span class="comment">/* no non-delimiter characters */</span>
00076     {
00077         *last = NULL;
00078         <span class="keywordflow">return</span> NULL;
00079     }
00080     tok = s - 1;
00081 
00082     <span class="comment">/*</span>
00083 <span class="comment">     * Scan token (scan for delimiters: s += strcspn(s, delim), sort of).</span>
00084 <span class="comment">     * Note that delim must have one NUL; we stop if we see that, too.</span>
00085 <span class="comment">     */</span>
00086     <span class="keywordflow">for</span> (;;)
00087     {
00088         c = *s++;
00089         spanp = (<span class="keywordtype">char</span> *)delim;
00090         <span class="keywordflow">do</span>
00091         {
00092             <span class="keywordflow">if</span> ((sc = *spanp++) == c)
00093             {
00094                 <span class="keywordflow">if</span> (c == 0)
00095                 {
00096                     s = NULL;
00097                 }
00098                 <span class="keywordflow">else</span>
00099                 {
00100                     <span class="keywordtype">char</span> *w = s - 1;
00101                     *w = <span class="charliteral">'\0'</span>;
00102                 }
00103                 *last = s;
00104                 <span class="keywordflow">return</span> tok;
00105             }
00106         }
00107         <span class="keywordflow">while</span> (sc != 0);
00108     }
00109     <span class="comment">/* NOTREACHED */</span>
00110 }
00111 
00112 <span class="preprocessor">#else</span>
00113 <span class="preprocessor"></span><span class="keywordtype">char</span> *strtok_r(<span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *delim, <span class="keywordtype">char</span> **last);
00114 <span class="preprocessor">#endif </span>
</pre></div><hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
