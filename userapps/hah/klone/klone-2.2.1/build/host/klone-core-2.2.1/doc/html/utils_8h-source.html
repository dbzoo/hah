<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KLone: utils.h Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>utils.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 2005, 2006 by KoanLogic s.r.l. &lt;http://www.koanlogic.com&gt;</span>
00003 <span class="comment"> * All rights reserved.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * This file is part of KLone, and as such it is subject to the license stated</span>
00006 <span class="comment"> * in the LICENSE file which you have received as part of this distribution.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * $Id: utils.h,v 1.35 2009/05/29 10:26:00 tho Exp $</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#ifndef _KLONE_UTILS_H_</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define _KLONE_UTILS_H_</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include "klone_conf.h"</span>
00015 <span class="preprocessor">#ifdef HAVE_STDINT</span>
00016 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdint.h&gt;</span>
00017 <span class="preprocessor">#endif </span><span class="comment">/* HAVE_STDINT */</span>
00018 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
00019 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00020 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00021 <span class="preprocessor">#include &lt;time.h&gt;</span>
00022 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00023 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00024 <span class="preprocessor">#include &lt;klone/io.h&gt;</span>
00025 <span class="preprocessor">#include &lt;klone/md5.h&gt;</span>
00026 <span class="preprocessor">#include &lt;klone/os.h&gt;</span>
00027 <span class="preprocessor">#include &lt;klone/mime_map.h&gt;</span>
00028 
00029 <span class="preprocessor">#ifdef __cplusplus</span>
00030 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00031 <span class="preprocessor">#endif</span>
00032 <span class="preprocessor"></span>
00033 <span class="preprocessor">#ifndef MIN</span>
00034 <span class="preprocessor"></span><span class="preprocessor">#define MIN(a,b)    (a &lt; b ? a : b)</span>
00035 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00036 <span class="preprocessor"></span>
00037 <span class="preprocessor">#ifndef MAX</span>
00038 <span class="preprocessor"></span><span class="preprocessor">#define MAX(a,b)    (a &gt; b ? a : b)</span>
00039 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
00040 <span class="preprocessor"></span>
00041 <span class="preprocessor">#define KLONE_FREE(p) do {if (p) { free(p); p = NULL; }} while (0)</span>
00042 <span class="preprocessor"></span>
00043 <span class="preprocessor">#define klone_die(...) do { con(__VA_ARGS__); exit(EXIT_FAILURE); } while(0)</span>
00044 <span class="preprocessor"></span><span class="preprocessor">#define klone_die_if(cond, ...) \</span>
00045 <span class="preprocessor">    do { dbg_ifb(cond) klone_die(__VA_ARGS__); } while(0)</span>
00046 <span class="preprocessor"></span>
00047 <span class="keyword">enum</span> { U_PATH_NOT_FOUND, U_PATH_IN_EMBFS, U_PATH_IN_FS };
00048 
00049 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga24">u_file_exists</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*);
00050 <span class="keywordtype">int</span> u_write_debug_message(<span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keyword">const</span> <span class="keywordtype">char</span>*, <span class="keywordtype">int</span>, <span class="keyword">const</span> <span class="keywordtype">char</span>*, 
00051     <span class="keyword">const</span> <span class="keywordtype">char</span>*, ...);
00052 
00053 <span class="keyword">struct </span>dirent;
00054 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga26">u_foreach_dir_item</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>,
00055     <span class="keywordtype">int</span> (*)(<span class="keyword">struct</span> dirent*, <span class="keyword">const</span> <span class="keywordtype">char</span> *, <span class="keywordtype">void</span>*), 
00056     <span class="keywordtype">void</span>*);
00057 
00058 <span class="keywordtype">char</span>* <a class="code" href="group__ut.html#ga27">u_strnrchr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keywordtype">char</span> c, size_t len);
00059 <span class="keywordtype">char</span> *<a class="code" href="group__ut.html#ga28">u_stristr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *string, <span class="keyword">const</span> <span class="keywordtype">char</span> *sub);
00060 <span class="keywordtype">char</span> *<a class="code" href="group__ut.html#ga29">u_strnstr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *string, <span class="keyword">const</span> <span class="keywordtype">char</span> *sub, size_t stringlen);
00061 
00062 <span class="keyword">enum</span> { U_COPY_VERBATIM, U_COPY_ENCODE, U_COPY_DECODE };
00063 
00064 <span class="keyword">enum</span> { URLCPY_VERBATIM, URLCPY_ENCODE, URLCPY_DECODE };
00065 ssize_t <a class="code" href="group__ut.html#ga30">u_urlncpy</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t slen, <span class="keywordtype">int</span> flags);
00066 
00067 <span class="keyword">enum</span> { HEXCPY_VERBATIM, HEXCPY_ENCODE, HEXCPY_DECODE };
00068 ssize_t <a class="code" href="group__ut.html#ga31">u_hexncpy</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t slen, <span class="keywordtype">int</span> flags);
00069 
00070 <span class="keyword">enum</span> { HTMLCPY_VERBATIM, HTMLCPY_ENCODE, HTMLCPY_DECODE };
00071 ssize_t <a class="code" href="group__ut.html#ga32">u_htmlncpy</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t slen, <span class="keywordtype">int</span> flags);
00072 
00073 <span class="keyword">enum</span> { SQLCPY_VERBATIM, SQLCPY_ENCODE, SQLCPY_DECODE };
00074 ssize_t <a class="code" href="group__ut.html#ga33">u_sqlncpy</a>(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t slen, <span class="keywordtype">int</span> flags);
00075 
00076 <span class="keywordtype">int</span> u_printf_ccstr(io_t *o, <span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t sz);
00077 
00078 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga35">u_file_open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> flags, io_t **pio);
00079 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga36">u_tmpfile_open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *tmpdir, io_t **pio);
00080 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga37">u_getline</a>(io_t *io, u_string_t *ln);
00081 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga38">u_fgetline</a>(FILE *in, u_string_t *ln);
00082 
00083 <span class="keywordtype">int</span> u_io_unzip_copy(io_t *out, <span class="keyword">const</span> <span class="keywordtype">char</span> *data, size_t size);
00084 
00085 <span class="keywordtype">void</span> <a class="code" href="group__ut.html#ga40">u_tohex</a>(<span class="keywordtype">char</span> *hex, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t sz);
00086 <span class="keywordtype">char</span> u_tochex(<span class="keywordtype">int</span> n);
00087 
00088 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga42">u_md5</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *buf, size_t sz, <span class="keywordtype">char</span> out[MD5_DIGEST_BUFSZ]);
00089 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga43">u_md5io</a>(io_t *io, <span class="keywordtype">char</span> out[MD5_DIGEST_BUFSZ]);
00090 
00091 <span class="keyword">typedef</span> void (*u_sig_t)(<span class="keywordtype">int</span>);
00092 <span class="keywordtype">int</span> u_signal(<span class="keywordtype">int</span> sig, u_sig_t handler);
00093 <span class="keywordtype">int</span> u_sig_block(<span class="keywordtype">int</span> sig);
00094 <span class="keywordtype">int</span> u_sig_unblock(<span class="keywordtype">int</span> sig);
00095 
00096 <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="group__ut.html#ga47">u_guess_mime_type</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *file_name);
00097 <span class="keyword">const</span> mime_map_t* <a class="code" href="group__ut.html#ga48">u_get_mime_map</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *file_name);
00098 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga49">u_match_ext</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keyword">const</span> <span class="keywordtype">char</span> *extension);
00099 
00100 <span class="comment">/* date time conversion funcs */</span>
00101 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga50">u_tt_to_rfc822</a>(<span class="keywordtype">char</span> dst[], time_t ts);
00102 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga51">u_httpdate_to_tt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, time_t *tp);
00103 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga52">u_rfc822_to_tt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, time_t *tp);
00104 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga53">u_rfc850_to_tt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, time_t *tp);
00105 <span class="keywordtype">int</span> <a class="code" href="group__ut.html#ga54">u_asctime_to_tt</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, time_t *tp);
00106 
00107 <span class="keywordtype">void</span> u_print_version_and_exit(<span class="keywordtype">void</span>);
00108 
00109 <span class="keywordtype">int</span> u_uri_normalize(<span class="keywordtype">char</span> *fqn);
00110 <span class="keywordtype">int</span> u_path_where_art_thou(<span class="keyword">const</span> <span class="keywordtype">char</span> *fqn, <span class="keywordtype">int</span> *where);
00111 
00112 <span class="keywordtype">int</span> u_pwd_init_agnostic (<span class="keyword">const</span> <span class="keywordtype">char</span> *fqn, <span class="keywordtype">int</span> hashed, <span class="keywordtype">int</span> in_memory, 
00113         u_pwd_t **ppwd);
00114 
00115 <span class="preprocessor">#ifdef HAVE_LIBOPENSSL</span>
00116 <span class="preprocessor"></span><span class="keywordtype">int</span> u_cipher_encrypt(<span class="keyword">const</span> EVP_CIPHER *cipher, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, 
00117     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *iv, <span class="keywordtype">char</span> *dst, size_t *dcount, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t ssz);
00118 <span class="keywordtype">int</span> u_cipher_decrypt(<span class="keyword">const</span> EVP_CIPHER *cipher, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *key, 
00119     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *iv, <span class="keywordtype">char</span> *dst, size_t *dcount, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t ssz);
00120 <span class="preprocessor">#endif</span>
00121 <span class="preprocessor"></span>
00122 <span class="preprocessor">#ifdef __cplusplus</span>
00123 <span class="preprocessor"></span>}
00124 <span class="preprocessor">#endif </span>
00125 <span class="preprocessor"></span>
00126 <span class="preprocessor">#endif</span>
</pre></div>
    </div>

    <div id="footer">
        <p>Copyright &copy; 
    2005-2007 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
         | Valid <a
        href="http://jigsaw.w3.org/css-validator/">CSS</a> &amp; <a
        href="http://validator.w3.org/">XHTML</a> | powered by <a
        href="/klone/index.html">KLone</a> </p>
    </div>
</body>

</html>


