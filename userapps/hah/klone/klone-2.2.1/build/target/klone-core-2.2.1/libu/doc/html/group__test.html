<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: Unit testing</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>Unit testing</h1><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__test.html#ga10">U_TEST_MODULE</a>(name)&nbsp;&nbsp;&nbsp;int u_test_run_ ## name (void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define a test module.  <a href="#ga10"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__test.html#ga11">U_TEST_RUN</a>(f)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Define a test function.  <a href="#ga11"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__test.html#ga12">U_TEST_MODULE_USE</a>(name)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Import a test module in the test program.  <a href="#ga12"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__test.html#ga9">u_test_run</a> (int argc, char **argv)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Run tests.  <a href="#ga9"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Tests are bundles in test modules defined by the U_TEST_MODULE macro; each module contain one or more test functions; such functions will be considered succesfull when returning 0. Function should be run from within the module main function wrapped by the U_TEST_RUN macro.<p>
Example: mymodule.c <pre class="fragment"><div>          <span class="keywordtype">int</span> test_feature_1(<span class="keywordtype">void</span>)
          {
              dbg_err_if(...)

              <span class="keywordflow">return</span> 0; 
          err:
              <span class="keywordflow">return</span> ~0;
          }

          <span class="keywordtype">int</span> test_feature_2(<span class="keywordtype">void</span>)
          {
              dbg_err_if(

              <span class="keywordflow">return</span> 0; 
          err:
              <span class="keywordflow">return</span> ~0;
          }

          <a class="code" href="group__test.html#ga10">U_TEST_MODULE</a>( mymodule )
          {
              <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_feature_1 );
              <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_feature_2 );
          
              <span class="keywordflow">return</span> 0;                                                
          }
</div></pre><p>
To build the 'runtest' executable define a main() function like the example below and import your test modules using the U_TEST_USE_MODULE macro.<p>
Example: <a class="el" href="main_8c.html">main.c</a> <pre class="fragment"><div><span class="preprocessor">          #include &lt;u/libu.h&gt;</span>

          <span class="keywordtype">int</span> <a class="code" href="group__log.html#ga0">facility</a> = LOG_LOCAL0;

          <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)
          {
              U_TEST_USE_MODULE( mymodule );
              U_TEST_USE_MODULE( mymodule2 );
          
              <span class="keywordflow">return</span> <a class="code" href="group__test.html#ga9">u_test_run</a>(argc, argv);
          }
</div></pre><p>
To run all tests call the built executable with no arguments. At the end of execution it will print the number of tests run and the number ot tests failed. <pre class="fragment"><div>
 *          ./runtest # runs all modules' test
 *          </div></pre><p>
If you want to run just selected modules add their name to the 'runtest' command line: <pre class="fragment"><div>
 *          ./runtest mymodule # runs just 'mymodule' tests
 *          ./runtest mymodule othermod # runs 'mymodule' and 'othermod' tests
 *          </div></pre><hr><h2>Define Documentation</h2>
<a class="anchor" name="ga10" doxytag="test.h::U_TEST_MODULE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define U_TEST_MODULE</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">name&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>&nbsp;&nbsp;&nbsp;int u_test_run_ ## name (void)
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Defines a test module named <code>name</code>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>name</em>&nbsp;</td><td>module name </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="test_8h-source.html#l00087">87</a> of file <a class="el" href="test_8h-source.html">test.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ga12" doxytag="test.h::U_TEST_MODULE_USE" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define U_TEST_MODULE_USE</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">name&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><div class="fragment"><pre><span class="keywordflow">do</span> {    \
        <span class="keywordtype">int</span> u_test_run_ ## name (<span class="keywordtype">void</span>); \
        *_top = u_test_run_ ## name; ++_top; *_top = NULL; \
        *_top_nm = <a class="code" href="group__misc.html#ga20">u_strdup</a>( #name ); ++_top_nm; *_top_nm = NULL; \
    } <span class="keywordflow">while</span>(0)
</pre></div>Import a test module to be use by the test program.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>name</em>&nbsp;</td><td>the name of the module </td></tr>
  </table>
</dl>

<p>
Definition at line <a class="el" href="test_8h-source.html#l00110">110</a> of file <a class="el" href="test_8h-source.html">test.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ga11" doxytag="test.h::U_TEST_RUN" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define U_TEST_RUN</td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">f&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
<b>Value:</b><div class="fragment"><pre><span class="keywordflow">if</span>( f () ) { _test_cnt++; _test_fail++; con(<span class="stringliteral">"%s: failed"</span>, #f); } \
    <span class="keywordflow">else</span> { _test_cnt++; _test_ok++; <span class="keywordflow">if</span>(_verbose) con(<span class="stringliteral">"%s: ok"</span>, #f); }
</pre></div>Defines a test function.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>f</em>&nbsp;</td><td>the function name</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><code>0</code> on success, not zero on failure (i.e. test failed) </dd></dl>

<p>
Definition at line <a class="el" href="test_8h-source.html#l00098">98</a> of file <a class="el" href="test_8h-source.html">test.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga9" doxytag="test.h::u_test_run" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int u_test_run </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char **&nbsp;</td>
          <td class="mdname" nowrap> <em>argv</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Run tests. Must be called by the main() function. Returns when all tests have been run.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign=top><em>argc</em>&nbsp;</td><td>main() argc argument </td></tr>
    <tr><td valign=top><em>argv</em>&nbsp;</td><td>main() argv argument</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd><code>0</code> on success, not zero on failure </dd></dl>

<p>
Definition at line <a class="el" href="test_8c-source.html#l00083">83</a> of file <a class="el" href="test_8c-source.html">test.c</a>.
<p>
References <a class="el" href="memory_8c-source.html#l00073">u_free()</a>.    </td>
  </tr>
</table>
<hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
