<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: array.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>array.c</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00002 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00003 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
00005 <span class="preprocessor">#include &lt;syslog.h&gt;</span>
00006 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00007 <span class="preprocessor">#include &lt;limits.h&gt;</span>
00008 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00009 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00010 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00011 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00012 
00013 <a class="code" href="group__test.html#ga10">U_TEST_MODULE</a>(array);
00014 
00015 <span class="keyword">static</span> <span class="keywordtype">int</span> test_resize (<span class="keywordtype">void</span>);
00016 <span class="keyword">static</span> <span class="keywordtype">int</span> test_short (<span class="keywordtype">void</span>);
00017 <span class="keyword">static</span> <span class="keywordtype">int</span> test_ptr (<span class="keywordtype">void</span>);
00018 <span class="keyword">static</span> <span class="keywordtype">int</span> test_u_short (<span class="keywordtype">void</span>);
00019 <span class="keyword">static</span> <span class="keywordtype">int</span> test_char (<span class="keywordtype">void</span>);
00020 <span class="keyword">static</span> <span class="keywordtype">int</span> test_u_char (<span class="keywordtype">void</span>);
00021 
00022 <span class="keyword">static</span> <span class="keywordtype">int</span> test_resize (<span class="keywordtype">void</span>)
00023 {
00024     u_array_t *da = NULL;
00025     size_t idx;
00026     <span class="keywordtype">short</span> s, s0;
00027 
00028     con_err_if (<a class="code" href="group__array.html#ga1">u_array_create</a>(U_ARRAY_TYPE_SHORT, 100, &amp;da));
00029 
00030     <span class="keywordflow">for</span> (s = SHRT_MIN, idx = 0; s &lt; SHRT_MAX; s++, idx++)
00031     {
00032         con_err_if (u_array_set_short(da, idx, s, NULL));
00033         con_err_if (u_array_get_short(da, idx, &amp;s0));
00034         con_err_ifm (s != s0, <span class="stringliteral">"s = %d, s0 = %d, idx = %zu"</span>, s, s0, idx);
00035     }
00036 
00037     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00038 
00039     <span class="keywordflow">return</span> 0;
00040 err:
00041     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00042 
00043     <span class="keywordflow">return</span> -1;
00044 }
00045 
00046 <span class="keyword">static</span> <span class="keywordtype">int</span> test_short (<span class="keywordtype">void</span>)
00047 {
00048     u_array_t *da = NULL;
00049     size_t idx;
00050     <span class="keywordtype">short</span> s, s0;
00051 
00052     con_err_if (<a class="code" href="group__array.html#ga1">u_array_create</a>(U_ARRAY_TYPE_SHORT, SHRT_MAX * 2 + 1, &amp;da));
00053 
00054     <span class="keywordflow">for</span> (s = SHRT_MIN, idx = 0; s &lt; SHRT_MAX; s++, idx++)
00055     {
00056         con_err_if (u_array_set_short(da, idx, s, NULL));
00057         con_err_if (u_array_get_short(da, idx, &amp;s0));
00058         con_err_ifm (s != s0, <span class="stringliteral">"s = %d, s0 = %d, idx = %zu"</span>, s, s0, idx);
00059     }
00060 
00061     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00062 
00063     <span class="keywordflow">return</span> 0;
00064 err:
00065     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00066 
00067     <span class="keywordflow">return</span> -1;
00068 }
00069 
00070 <span class="keyword">static</span> <span class="keywordtype">int</span> test_ptr (<span class="keywordtype">void</span>)
00071 {
00072     u_array_t *da = NULL;
00073     size_t idx;
00074     <span class="keyword">struct </span>S { <span class="keywordtype">int</span> i; <span class="keywordtype">char</span> c; } s, *s0;
00075 
00076     con_err_if (<a class="code" href="group__array.html#ga1">u_array_create</a>(U_ARRAY_TYPE_PTR, 10, &amp;da));
00077 
00078     <span class="keywordflow">for</span> (idx = 0; idx &lt; 100; idx++)
00079     {
00080         s.i = (<span class="keywordtype">int</span>) idx;
00081         s.c = (<span class="keywordtype">char</span>) idx;
00082 
00083         con_err_if (u_array_set_ptr(da, idx, (<span class="keywordtype">void</span> *) &amp;s, NULL));
00084         con_err_if (u_array_get_ptr(da, idx, (<span class="keywordtype">void</span> **) &amp;s0));
00085 
00086         con_err_if (s.i != s0-&gt;i);
00087         con_err_if (s.c != s0-&gt;c);
00088     }
00089 
00090     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00091 
00092     <span class="keywordflow">return</span> 0;
00093 err:
00094     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00095 
00096     <span class="keywordflow">return</span> -1;
00097 }
00098 
00099 <span class="keyword">static</span> <span class="keywordtype">int</span> test_u_short (<span class="keywordtype">void</span>)
00100 {
00101     u_array_t *da = NULL;
00102     size_t idx;
00103     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> s, s0;
00104 
00105     con_err_if (<a class="code" href="group__array.html#ga1">u_array_create</a>(U_ARRAY_TYPE_U_SHORT, USHRT_MAX + 1, &amp;da));
00106 
00107     <span class="keywordflow">for</span> (s = 0, idx = 0; s &lt; USHRT_MAX; s++, idx++)
00108     {
00109         con_err_if (u_array_set_u_short(da, idx, s, NULL));
00110         con_err_if (u_array_get_u_short(da, idx, &amp;s0));
00111         con_err_ifm (s != s0, <span class="stringliteral">"s = %d, s0 = %d, idx = %zu"</span>, s, s0, idx);
00112     }
00113 
00114     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00115 
00116     <span class="keywordflow">return</span> 0;
00117 err:
00118     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00119 
00120     <span class="keywordflow">return</span> -1;
00121 }
00122 
00123 <span class="keyword">static</span> <span class="keywordtype">int</span> test_char (<span class="keywordtype">void</span>)
00124 {
00125     u_array_t *da = NULL;
00126     size_t idx;
00127     <span class="keywordtype">char</span> s, s0;
00128 
00129     con_err_if (<a class="code" href="group__array.html#ga1">u_array_create</a>(U_ARRAY_TYPE_CHAR, CHAR_MAX * 2 + 1, &amp;da));
00130 
00131     <span class="keywordflow">for</span> (s = CHAR_MIN, idx = 0; s &lt; CHAR_MAX; s++, idx++)
00132     {
00133         con_err_if (<a class="code" href="group__array.html#ga4">u_array_set_char</a>(da, idx, s, NULL));
00134         con_err_if (<a class="code" href="group__array.html#ga15">u_array_get_char</a>(da, idx, &amp;s0));
00135         con_err_ifm (s != s0, <span class="stringliteral">"s = %d, s0 = %d, idx = %zu"</span>, s, s0, idx);
00136     }
00137 
00138     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00139 
00140     <span class="keywordflow">return</span> 0;
00141 err:
00142     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00143 
00144     <span class="keywordflow">return</span> -1;
00145 }
00146 
00147 <span class="keyword">static</span> <span class="keywordtype">int</span> test_u_char (<span class="keywordtype">void</span>)
00148 {
00149     size_t idx;
00150     u_array_t *da = NULL;
00151     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> s, s0;
00152 
00153     con_err_if (<a class="code" href="group__array.html#ga1">u_array_create</a>(U_ARRAY_TYPE_U_CHAR, UCHAR_MAX + 1, &amp;da));
00154 
00155     <span class="keywordflow">for</span> (s = 0, idx = 0; s &lt; UCHAR_MAX; s++, idx++)
00156     {
00157         con_err_if (u_array_set_u_char(da, idx, s, NULL));
00158         con_err_if (u_array_get_u_char(da, idx, &amp;s0));
00159         con_err_ifm (s != s0, <span class="stringliteral">"s = %d, s0 = %d, idx = %zu"</span>, s, s0, idx);
00160     }
00161 
00162     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00163 
00164     <span class="keywordflow">return</span> 0;
00165 err:
00166     <a class="code" href="group__array.html#ga2">u_array_free</a>(da);
00167 
00168     <span class="keywordflow">return</span> -1;
00169 }
00170 
00171 <a class="code" href="group__test.html#ga10">U_TEST_MODULE</a>( array )
00172 {
00173     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_ptr );
00174     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_short );
00175     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_u_short );
00176     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_char );
00177     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_u_char );
00178     <a class="code" href="group__test.html#ga11">U_TEST_RUN</a>( test_resize );
00179 
00180     <span class="keywordflow">return</span> 0;                                                
00181 }
</pre></div><hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
