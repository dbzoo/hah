<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KLone: backend.h Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>backend.h</h1><div class="fragment"><pre>00001 <span class="comment">/*</span>
00002 <span class="comment"> * Copyright (c) 2005, 2006 by KoanLogic s.r.l. &lt;http://www.koanlogic.com&gt;</span>
00003 <span class="comment"> * All rights reserved.</span>
00004 <span class="comment"> *</span>
00005 <span class="comment"> * This file is part of KLone, and as such it is subject to the license stated</span>
00006 <span class="comment"> * in the LICENSE file which you have received as part of this distribution.</span>
00007 <span class="comment"> *</span>
00008 <span class="comment"> * $Id: backend.h,v 1.17 2008/06/04 17:48:01 tat Exp $</span>
00009 <span class="comment"> */</span>
00010 
00011 <span class="preprocessor">#ifndef _KLONE_BACKEND_H_</span>
00012 <span class="preprocessor"></span><span class="preprocessor">#define _KLONE_BACKEND_H_</span>
00013 <span class="preprocessor"></span>
00014 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00015 <span class="preprocessor">#include &lt;klone/klog.h&gt;</span>
00016 
00017 <span class="preprocessor">#ifdef __cplusplus</span>
00018 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00019 <span class="preprocessor">#endif </span>
00020 <span class="preprocessor"></span>
00021 <span class="keyword">struct </span>server_s;
00022 
00023 <span class="comment">/* define page list */</span>
00024 LIST_HEAD(backends_s, backend_s);
00025 
00026 <span class="keyword">struct </span>backend_s
00027 {
00028     <span class="comment">/* statically initialized values */</span>
00029     <span class="keyword">const</span> <span class="keywordtype">char</span> *proto;
00030     int (*cb_init)(<span class="keyword">struct </span>backend_s *);
00031     int (*cb_serve)(<span class="keyword">struct </span>backend_s *, <span class="keywordtype">int</span>);
00032     int (*cb_term)(<span class="keyword">struct </span>backend_s *);
00033 
00034     <span class="comment">/* runtime values */</span>
00035     <span class="keyword">struct </span>server_s *server;
00036     u_config_t *config;
00037     <span class="keyword">struct </span>kaddr_s *addr; 
00038     <span class="keywordtype">int</span> model;
00039     <span class="keywordtype">int</span> ld;
00040     <span class="keywordtype">void</span> *arg;
00041     klog_t *klog;
00042     <span class="keywordtype">int</span> <span class="keywordtype">id</span>;
00043     size_t nchild;
00044     size_t max_child;
00045     size_t start_child;
00046     size_t max_rq_xchild;
00047     size_t fork_child;
00048     pid_t *child_pid;           <span class="comment">/* pid of children              */</span>
00049     LIST_ENTRY(backend_s) np;   <span class="comment">/* next &amp; prev pointers         */</span>
00050 };
00051 
00052 <span class="keyword">typedef</span> <span class="keyword">struct </span>backend_s backend_t;
00053 <span class="keyword">typedef</span> <span class="keyword">struct </span>backends_s backends_t; <span class="comment">/* backend_t list        */</span>
00054 
00055 <span class="preprocessor">#define BACKEND_STATIC_INITIALIZER(proto, init, connect, term)  \</span>
00056 <span class="preprocessor">    {                                                           \</span>
00057 <span class="preprocessor">        proto,                                                  \</span>
00058 <span class="preprocessor">        init,                                                   \</span>
00059 <span class="preprocessor">        connect,                                                \</span>
00060 <span class="preprocessor">        term,                                                   \</span>
00061 <span class="preprocessor">        NULL,   </span><span class="comment">/* server       */</span>                              \
00062         NULL,   <span class="comment">/* config       */</span>                              \
00063         NULL,   <span class="comment">/* addr         */</span>                              \
00064         0,      <span class="comment">/* model        */</span>                              \
00065         -1,     <span class="comment">/* ld           */</span>                              \
00066         NULL,   <span class="comment">/* arg          */</span>                              \
00067         NULL,   <span class="comment">/* klog         */</span>                              \
00068         -1,     <span class="comment">/* id           */</span>                              \
00069         0,      <span class="comment">/* nchild       */</span>                              \
00070         0,      <span class="comment">/* max_child    */</span>                              \
00071         0,      <span class="comment">/* start_child  */</span>                              \
00072         0,      <span class="comment">/* max_rq_xchild*/</span>                              \
00073         0,      <span class="comment">/* fork_child   */</span>                              \
00074         NULL,   <span class="comment">/* children pids*/</span>                              \
00075         LIST_ENTRY_NULL                                         \
00076     }
00077 
00078 
00079 <span class="keyword">extern</span> backend_t *backend_list[];
00080 
00081 <span class="keywordtype">int</span> backend_create(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, u_config_t *, backend_t **);
00082 <span class="keywordtype">int</span> backend_serve(backend_t *, <span class="keywordtype">int</span> fd);
00083 <span class="keywordtype">int</span> backend_free(backend_t *);
00084 
00085 <span class="preprocessor">#ifdef __cplusplus</span>
00086 <span class="preprocessor"></span>}
00087 <span class="preprocessor">#endif </span>
00088 <span class="preprocessor"></span>
00089 <span class="preprocessor">#endif</span>
</pre></div>
    </div>

    <div id="footer">
        <p>Copyright &copy; 
    2005-2007 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
         | Valid <a
        href="http://jigsaw.w3.org/css-validator/">CSS</a> &amp; <a
        href="http://validator.w3.org/">XHTML</a> | powered by <a
        href="/klone/index.html">KLone</a> </p>
    </div>
</body>

</html>


