<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KLone: child.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">Globals</a></div>
<h1>child.c</h1><div class="fragment"><pre>00001 <span class="preprocessor">#include "klone_conf.h"</span>
00002 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00003 <span class="preprocessor">#include "child.h"</span>
00004 
00005 TAILQ_HEAD(child_list_s, child_s);
00006 <span class="keyword">typedef</span> <span class="keyword">struct </span>child_list_s child_list_t;
00007 
00008 <span class="keyword">struct </span>children_s
00009 {
00010     child_list_t clist;
00011     size_t nchild;
00012 };
00013 
00014 <span class="keywordtype">int</span> children_add(children_t *cs, child_t *child)
00015 {
00016     dbg_return_if (cs == NULL, ~0);
00017     dbg_return_if (child == NULL, ~0);
00018 
00019     TAILQ_INSERT_TAIL(&amp;cs-&gt;clist, child, np);
00020     cs-&gt;nchild++;
00021 
00022     <span class="keywordflow">return</span> 0;
00023 }
00024 
00025 <span class="keywordtype">int</span> children_del(children_t *cs, child_t *child)
00026 {
00027     dbg_return_if (cs == NULL, ~0);
00028     dbg_return_if (child == NULL, ~0);
00029 
00030     TAILQ_REMOVE(&amp;cs-&gt;clist, child, np);
00031     cs-&gt;nchild--;
00032 
00033     <span class="keywordflow">return</span> 0;
00034 }
00035 
00036 size_t children_count(children_t *cs)
00037 {
00038     dbg_return_if (cs == NULL, 0);
00039 
00040     <span class="keywordflow">return</span> cs-&gt;nchild;
00041 }
00042 
00043 <span class="keywordtype">int</span> children_clear(children_t *cs)
00044 {
00045     child_t *c;
00046 
00047     dbg_err_if (cs == NULL);
00048 
00049     <span class="comment">/* free all variables */</span>
00050     <span class="keywordflow">while</span>((c = TAILQ_FIRST(&amp;cs-&gt;clist)) != NULL)
00051     {
00052         <span class="keywordflow">if</span>(!children_del(cs, c))
00053             child_free(c);
00054     }
00055 
00056     <span class="keywordflow">return</span> 0;
00057 err:
00058     <span class="keywordflow">return</span> 0;
00059 }
00060 
00061 <span class="keywordtype">int</span> children_getn(children_t *cs, size_t i, child_t **pc)
00062 {
00063     child_t *c;
00064 
00065     dbg_err_if (cs == NULL);
00066     dbg_err_if (pc == NULL);
00067     dbg_err_if (i &gt;= cs-&gt;nchild); <span class="comment">/* out of bounds */</span>
00068 
00069     TAILQ_FOREACH(c, &amp;cs-&gt;clist, np)
00070     {
00071         <span class="keywordflow">if</span>(i-- == 0)
00072         {
00073             *pc = c;
00074             <span class="keywordflow">return</span> 0; <span class="comment">/* found */</span>
00075         }
00076     }
00077 
00078 err:
00079     <span class="keywordflow">return</span> ~0;
00080 }
00081 
00082 <span class="keywordtype">int</span> children_get_by_pid(children_t *cs, pid_t pid, child_t **pc)
00083 {
00084     child_t *c;
00085 
00086     dbg_goto_if (cs == NULL, notfound);
00087     dbg_goto_if (pc == NULL, notfound);
00088 
00089     TAILQ_FOREACH(c, &amp;cs-&gt;clist, np)
00090     {
00091         <span class="keywordflow">if</span>(c-&gt;pid == pid)
00092         {
00093             *pc = c;
00094             <span class="keywordflow">return</span> 0; <span class="comment">/* found */</span>
00095         }
00096     }
00097 
00098 notfound:
00099     <span class="keywordflow">return</span> ~0; <span class="comment">/* not found */</span>
00100 }
00101 
00102 <span class="keywordtype">int</span> children_free(children_t *cs)
00103 {
00104     <span class="keywordflow">if</span>(cs)
00105     {
00106         <span class="comment">/* del and free all child_t objects */</span>
00107         dbg_if(children_clear(cs));
00108         U_FREE(cs);
00109     }
00110 
00111     <span class="keywordflow">return</span> 0;
00112 }
00113 
00114 <span class="keywordtype">int</span> children_create(children_t **pcs)
00115 {
00116     children_t *cs;
00117 
00118     dbg_err_if (pcs == NULL);
00119 
00120     cs = u_zalloc(<span class="keyword">sizeof</span>(children_t));
00121     dbg_err_if(cs == NULL);
00122 
00123     TAILQ_INIT(&amp;cs-&gt;clist);
00124 
00125     *pcs = cs;
00126 
00127     <span class="keywordflow">return</span> 0;
00128 err:
00129     <span class="keywordflow">return</span> ~0;
00130 }
00131 
00132 <span class="keywordtype">int</span> child_create(pid_t pid, backend_t *be, child_t **pchild)
00133 {
00134     child_t *c;
00135 
00136     dbg_err_if (pchild == NULL);
00137 
00138     c = u_zalloc(<span class="keyword">sizeof</span>(child_t));
00139     dbg_err_if(c == NULL);
00140 
00141     c-&gt;pid = pid;
00142     c-&gt;be = be;
00143     c-&gt;birth = time(0);
00144 
00145     *pchild = c;
00146 
00147     <span class="keywordflow">return</span> 0;
00148 err:
00149     <span class="keywordflow">return</span> ~0;
00150 }
00151 
00152 <span class="keywordtype">int</span> child_free(child_t *child)
00153 {
00154     U_FREE(child);
00155     <span class="keywordflow">return</span> 0;
00156 }
00157 
</pre></div>
    </div>

    <div id="footer">
        <p>Copyright &copy; 
    2005-2007 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
         | Valid <a
        href="http://jigsaw.w3.org/css-validator/">CSS</a> &amp; <a
        href="http://validator.w3.org/">XHTML</a> | powered by <a
        href="/klone/index.html">KLone</a> </p>
    </div>
</body>

</html>


