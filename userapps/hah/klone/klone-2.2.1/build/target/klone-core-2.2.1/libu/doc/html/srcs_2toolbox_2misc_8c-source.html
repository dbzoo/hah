<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: misc.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>misc.c</h1><div class="fragment"><pre>00001 <span class="comment">/* </span>
00002 <span class="comment"> * Copyright (c) 2005-2008 by KoanLogic s.r.l. - All rights reserved.  </span>
00003 <span class="comment"> */</span>
00004 
00005 <span class="preprocessor">#include &lt;u/libu_conf.h&gt;</span>
00006 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00007 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00008 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00009 <span class="preprocessor">#include &lt;string.h&gt;</span>
00010 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00011 <span class="preprocessor">#include &lt;time.h&gt;</span>
00012 <span class="preprocessor">#include &lt;errno.h&gt;</span>
00013 <span class="preprocessor">#include &lt;signal.h&gt;</span>
00014 <span class="preprocessor">#include &lt;ctype.h&gt;</span>
00015 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00016 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00017 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00018 
00019 <span class="preprocessor">#include &lt;toolbox/misc.h&gt;</span>
00020 <span class="preprocessor">#include &lt;toolbox/carpal.h&gt;</span>
00021 <span class="preprocessor">#include &lt;toolbox/memory.h&gt;</span>
00022 
<a name="l00030"></a><a class="code" href="group__misc.html#ga0">00030</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga0">u_isblank</a>(<span class="keywordtype">int</span> c)
00031 {
00032     <span class="keywordflow">return</span> c == <span class="charliteral">' '</span> || c == <span class="charliteral">'\t'</span>;
00033 }
00034 
<a name="l00037"></a><a class="code" href="group__misc.html#ga1">00037</a> <span class="keywordtype">void</span> <a class="code" href="group__misc.html#ga1">u_trim</a>(<span class="keywordtype">char</span> *s)
00038 {
00039     <span class="keywordtype">char</span> *p;
00040 
00041     <span class="keywordflow">if</span>(!s)
00042         <span class="keywordflow">return</span>;
00043 
00044     <span class="comment">/* trim trailing blanks */</span>
00045     p = s + strlen(s) -1;
00046     <span class="keywordflow">while</span>(s &lt; p &amp;&amp; <a class="code" href="group__misc.html#ga0">u_isblank</a>(*p))
00047         --p;
00048     p[1] = 0;
00049 
00050     <span class="comment">/* trim leading blanks */</span>
00051     p = s;
00052     <span class="keywordflow">while</span>(*p &amp;&amp; <a class="code" href="group__misc.html#ga0">u_isblank</a>(*p))
00053         ++p;
00054 
00055     <span class="keywordflow">if</span>(p &gt; s)
00056         memmove(s, p, 1 + strlen(p));
00057 }
00058 
<a name="l00062"></a><a class="code" href="group__misc.html#ga2">00062</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga2">u_isblank_str</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *ln)
00063 {
00064     <span class="keywordflow">for</span>(; *ln; ++ln)
00065         <span class="keywordflow">if</span>(!<a class="code" href="group__misc.html#ga0">u_isblank</a>(*ln))
00066             <span class="keywordflow">return</span> 0;
00067     <span class="keywordflow">return</span> 1;
00068 }
00069 
<a name="l00073"></a><a class="code" href="group__misc.html#ga3">00073</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga3">u_isnl</a>(<span class="keywordtype">int</span> c)
00074 {
00075     <span class="keywordflow">return</span> c == <span class="charliteral">'\n'</span> || c == <span class="charliteral">'\r'</span>;
00076 }
00077 
<a name="l00081"></a><a class="code" href="group__misc.html#ga4">00081</a> <span class="keywordtype">char</span> *<a class="code" href="group__misc.html#ga4">u_strndup</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s, size_t len)
00082 {
00083     <span class="keywordtype">char</span> *cp;
00084 
00085     <span class="keywordflow">if</span>((cp = (<span class="keywordtype">char</span>*) <a class="code" href="group__alloc.html#ga4">u_malloc</a>(len + 1)) == NULL)
00086         <span class="keywordflow">return</span> NULL;
00087     memcpy(cp, s, len);
00088     cp[len] = 0;
00089     <span class="keywordflow">return</span> cp;
00090 }
00091 
<a name="l00093"></a><a class="code" href="group__misc.html#ga5">00093</a> <span class="keywordtype">char</span> *<a class="code" href="group__misc.html#ga5">u_strdup</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)
00094 {
00095     <span class="keywordflow">return</span> <a class="code" href="group__misc.html#ga4">u_strndup</a>(s, strlen(s));
00096 }
00097 
<a name="l00102"></a><a class="code" href="group__misc.html#ga6">00102</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga6">u_savepid</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *pf)
00103 {
00104     FILE *pfp = NULL;
00105 
00106     dbg_return_if (pf == NULL, ~0);
00107 
00108     dbg_err_sif ((pfp = fopen(pf, <span class="stringliteral">"w"</span>)) == NULL);
00109     dbg_err_sif (fprintf(pfp, <span class="stringliteral">"%ld\n"</span>, (<span class="keywordtype">long</span>) getpid()) == 0);
00110     fclose(pfp);
00111 
00112     <span class="keywordflow">return</span> 0;
00113 err:
00114     U_FCLOSE(pfp);
00115     <span class="keywordflow">return</span> ~0;
00116 }
00117 
<a name="l00123"></a><a class="code" href="group__misc.html#ga7">00123</a> <span class="keywordtype">char</span> *<a class="code" href="group__misc.html#ga7">u_sstrncpy</a> (<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t size)
00124 {
00125     dst[size] = <span class="charliteral">'\0'</span>;
00126     <span class="keywordflow">return</span> strncpy(dst, src, size);
00127 }
00128 
<a name="l00132"></a><a class="code" href="group__misc.html#ga8">00132</a> <span class="keywordtype">void</span>* <a class="code" href="group__misc.html#ga8">u_memdup</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *src, size_t size)
00133 {
00134     <span class="keywordtype">void</span> *p;
00135 
00136     p = <a class="code" href="group__alloc.html#ga4">u_malloc</a>(size);
00137     <span class="keywordflow">if</span>(p)
00138         memcpy(p, src, size);
00139     <span class="keywordflow">return</span> p;
00140 }
00141 
<a name="l00178"></a><a class="code" href="group__misc.html#ga9">00178</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga9">u_strtok</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *s, <span class="keyword">const</span> <span class="keywordtype">char</span> *delim, <span class="keywordtype">char</span> ***ptv, size_t *pnelems)
00179 {
00180     <span class="keyword">enum</span> { TV_NSLOTS_DFLT = 10, TV_NSLOTS_INCR = 10 };
00181     <span class="keywordtype">char</span> **ap, **tv = NULL, **ntv = NULL;
00182     size_t nelems, tv_slots = TV_NSLOTS_DFLT;
00183     <span class="keywordtype">char</span> *p, *sdup = NULL;
00184 
00185     dbg_return_if (s == NULL, ~0);
00186     dbg_return_if (delim == NULL, ~0);
00187     dbg_return_if (ptv == NULL, ~0);
00188     dbg_return_if (pnelems == NULL, ~0);
00189     
00190     sdup = <a class="code" href="group__misc.html#ga5">u_strdup</a>(s);
00191     dbg_err_if (sdup == NULL);
00192 
00193     p = sdup;
00194     ap = tv;
00195     nelems = 0;
00196 
00197 expand:
00198     ntv = <a class="code" href="group__alloc.html#ga7">u_realloc</a>(tv, tv_slots * <span class="keyword">sizeof</span>(<span class="keywordtype">char</span> *));
00199     dbg_err_sif (ntv == NULL);
00200 
00201     <span class="comment">/* recalc 'ap' in case realloc has changed the base pointer */</span>
00202     <span class="keywordflow">if</span> (ntv != tv)
00203         ap = ntv + (ap - tv);
00204 
00205     tv = ntv;
00206 
00207     <span class="keywordflow">for</span> (; (*ap = strsep(&amp;p, delim)) != NULL; )
00208     {
00209         <span class="comment">/* skip empty field */</span>
00210         <span class="keywordflow">if</span> (**ap == <span class="charliteral">'\0'</span>)
00211             <span class="keywordflow">continue</span>;
00212 
00213         ++nelems;
00214 
00215         <span class="comment">/* when we reach the last slot, request new slots */</span>
00216         <span class="keywordflow">if</span> (++ap == &amp;tv[tv_slots - 1])
00217         {
00218             tv_slots += TV_NSLOTS_INCR;
00219             <span class="keywordflow">goto</span> expand;
00220         }
00221     }
00222 
00223     <span class="comment">/* save the dup'd string on the last slot */</span>
00224     *ap = sdup;
00225 
00226     <span class="comment">/* copy out */</span>
00227     *ptv = tv;
00228     *pnelems = nelems;
00229 
00230     <span class="keywordflow">return</span> 0;
00231 err:
00232     U_FREE(sdup);
00233     U_FREE(tv);
00234     <span class="keywordflow">return</span> ~0;
00235 }
00236 
<a name="l00245"></a><a class="code" href="group__misc.html#ga10">00245</a> <span class="keywordtype">void</span> <a class="code" href="group__misc.html#ga10">u_strtok_cleanup</a> (<span class="keywordtype">char</span> **tv, size_t nelems)
00246 {
00247     <span class="keywordflow">if</span> (tv)
00248     {
00249         U_FREE(tv[nelems]);
00250         <a class="code" href="group__alloc.html#ga8">u_free</a>(tv);
00251     }
00252 
00253     <span class="keywordflow">return</span>;
00254 }
00255 
<a name="l00270"></a><a class="code" href="group__misc.html#ga11">00270</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga11">u_tokenize</a> (<span class="keywordtype">char</span> *wlist, <span class="keyword">const</span> <span class="keywordtype">char</span> *delim, <span class="keywordtype">char</span> **tokv, size_t tokv_sz)
00271 {
00272     <span class="keywordtype">char</span> **ap;
00273 
00274     dbg_return_if (wlist == NULL, ~0);
00275     dbg_return_if (delim == NULL, ~0);
00276     dbg_return_if (tokv == NULL, ~0);
00277     dbg_return_if (tokv_sz == 0, ~0);
00278 
00279     ap = tokv;
00280 
00281     <span class="keywordflow">for</span> ( ; (*ap = strsep(&amp;wlist, delim)) != NULL; )
00282     {
00283         <span class="comment">/* skip empty field */</span>
00284         <span class="keywordflow">if</span> (**ap == <span class="charliteral">'\0'</span>)
00285             <span class="keywordflow">continue</span>;
00286 
00287         <span class="comment">/* check bounds */</span>
00288         <span class="keywordflow">if</span> (++ap &gt;= &amp;tokv[tokv_sz - 1])
00289             <span class="keywordflow">break</span>;
00290     }
00291 
00292     <span class="comment">/* put an explicit stopper to tokv */</span>
00293     *ap = NULL;
00294 
00295     <span class="keywordflow">return</span> 0;
00296 }
00297 
<a name="l00309"></a><a class="code" href="group__misc.html#ga12">00309</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga12">u_snprintf</a>(<span class="keywordtype">char</span> *str, size_t size, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
00310 {
00311     va_list ap;
00312     <span class="keywordtype">int</span> wr;
00313 
00314     va_start(ap, fmt);
00315 
00316     wr = vsnprintf(str, size, fmt, ap);
00317 
00318     va_end(ap);
00319 
00320     dbg_err_if(wr &lt; 0 || wr &gt;= (<span class="keywordtype">int</span>)size);
00321 
00322     <span class="keywordflow">return</span> 0;
00323 err:
00324     <span class="keywordflow">return</span> ~0;
00325 }
00326 
<a name="l00340"></a><a class="code" href="group__misc.html#ga13">00340</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga13">u_path_snprintf</a>(<span class="keywordtype">char</span> *buf, size_t sz, <span class="keywordtype">char</span> sep, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)
00341 {
00342     va_list ap;
00343     <span class="keywordtype">int</span> wr, i, len;
00344 
00345     va_start(ap, fmt);
00346 
00347     wr = vsnprintf(buf, sz, fmt, ap);
00348 
00349     va_end(ap);
00350 
00351     dbg_err_if(wr &lt; 0 || wr &gt;= (<span class="keywordtype">int</span>)sz);
00352 
00353     <span class="comment">/* remove multiple consecutive '/' */</span>
00354     <span class="keywordflow">for</span>(len = i = strlen(buf); i &gt; 0; --i)
00355     {
00356         <span class="keywordflow">if</span>(buf[i] == sep &amp;&amp; buf[i-1] == sep)
00357         {
00358             memmove(buf + i, buf + i + 1, len - i);
00359             len--;
00360         }
00361     }
00362 
00363     <span class="keywordflow">return</span> 0;
00364 err:
00365     <span class="keywordflow">return</span> ~0;
00366 }
00367 
00368 <span class="keyword">inline</span> <span class="keywordtype">void</span> u_use_unused_args(<span class="keywordtype">char</span> *dummy, ...)
00369 {
00370     dummy = 0;
00371     <span class="keywordflow">return</span>;
00372 }
00373 
<a name="l00375"></a><a class="code" href="group__misc.html#ga15">00375</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga15">u_data_is_bin</a> (<span class="keywordtype">char</span> *data, size_t sz)
00376 {
00377     size_t i;
00378 
00379     <span class="keywordflow">for</span> (i = 0; i &lt; sz; i++)
00380     {
00381         <span class="keywordflow">if</span> (!isascii(data[i]))
00382             <span class="keywordflow">return</span> 1;
00383     }
00384 
00385     <span class="keywordflow">return</span> 0;
00386 }
00387 
00388 <span class="keywordtype">int</span> u_data_dump (<span class="keywordtype">char</span> *data, size_t sz, <span class="keyword">const</span> <span class="keywordtype">char</span> *file)
00389 {
00390     FILE *fp = NULL;
00391 
00392     dbg_err_if ((fp = fopen(file, <span class="stringliteral">"w"</span>)) == NULL); 
00393     dbg_err_if (fwrite(data, sz, 1, fp) &lt; 1);
00394     fclose(fp);
00395 
00396     <span class="keywordflow">return</span> 0;
00397 err:
00398     U_FCLOSE(fp); 
00399     <span class="keywordflow">return</span> ~0;
00400 }
00401 
<a name="l00413"></a><a class="code" href="group__misc.html#ga17">00413</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga17">u_load_file</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *path, size_t sz_max, <span class="keywordtype">char</span> **pbuf, size_t *psz)
00414 {   
00415     FILE *fp = NULL;
00416     <span class="keywordtype">char</span> *buf = NULL;
00417     size_t sz; 
00418     <span class="keyword">struct </span>stat sb;
00419     
00420     dbg_return_if (path == NULL, ~0);
00421     dbg_return_if (pbuf == NULL, ~0);
00422     dbg_return_if (psz == NULL, ~0);
00423     
00424     dbg_err_sifm ((fp = fopen(path, <span class="stringliteral">"r"</span>)) == NULL, <span class="stringliteral">"%s"</span>, path);
00425     dbg_err_sifm (fstat(fileno(fp), &amp;sb) == -1, <span class="stringliteral">"%s"</span>, path); 
00426     sz = sb.st_size;
00427     dbg_err_ifm (sz_max &gt; 0 &amp;&amp; sz &gt; sz_max, 
00428             <span class="stringliteral">"file too big (%zu vs %zu bytes)"</span>, sz, sz_max);
00429     dbg_err_sif ((buf = <a class="code" href="group__alloc.html#ga6">u_zalloc</a>(sz)) == NULL);
00430     dbg_err_sifm (fread(buf, sz, 1, fp) != 1, <span class="stringliteral">"%s"</span>, path);
00431     
00432     U_FCLOSE(fp);
00433     
00434     *pbuf = buf;
00435     *psz = sz;
00436     
00437     <span class="keywordflow">return</span> 0;
00438 err:
00439     U_FCLOSE(fp);
00440     U_FREE(buf);
00441     <span class="keywordflow">return</span> ~0;
00442 }
00443 
<a name="l00466"></a><a class="code" href="group__misc.html#ga18">00466</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga18">u_io</a> (iof_t f, <span class="keywordtype">int</span> sd, <span class="keywordtype">void</span> *buf, size_t l, ssize_t *n, <span class="keywordtype">int</span> *eof)
00467 {
00468 <span class="preprocessor">#define SET_PPTR(pptr, val) do {if ((pptr)) *(pptr) = (val);} while (0);</span>
00469 <span class="preprocessor"></span>    ssize_t nret;
00470     size_t nleft = l;
00471     <span class="keywordtype">char</span> *p = buf;
00472 
00473     SET_PPTR(n, 0);
00474     SET_PPTR(eof, 0);
00475 
00476     <span class="keywordflow">while</span> (nleft &gt; 0) 
00477     {
00478         <span class="keywordflow">if</span> ((nret = (f) (sd, p, nleft)) == -1)
00479         {
00480             <span class="keywordflow">if</span> (errno == EINTR)
00481                 <span class="keywordflow">continue</span>;
00482             <span class="keywordflow">else</span>
00483             {
00484                 dbg_strerror(errno);
00485                 <span class="keywordflow">goto</span> end;
00486             }
00487         }
00488 
00489         <span class="comment">/* test EOF */</span>
00490         <span class="keywordflow">if</span> (nret == 0)
00491         {
00492             SET_PPTR(eof, 1);
00493             <span class="keywordflow">goto</span> end;
00494         }
00495         
00496         nleft -= nret;
00497         p += nret;
00498     }
00499 
00500 end:
00501     SET_PPTR(n, l - nleft);
00502     <span class="keywordflow">return</span> nleft ? ~0 : 0;
00503 <span class="preprocessor">#undef SET_PPTR</span>
00504 <span class="preprocessor"></span>}
00505 
<a name="l00513"></a><a class="code" href="group__misc.html#ga19">00513</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga19">u_sleep</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> secs)
00514 {
00515 <span class="preprocessor">#ifdef OS_WIN</span>
00516 <span class="preprocessor"></span>    Sleep(secs * 1000);
00517 <span class="preprocessor">#else</span>
00518 <span class="preprocessor"></span>    <span class="keywordtype">int</span> sleep_for, c;
00519 
00520     <span class="keywordflow">for</span>(sleep_for = secs; sleep_for &gt; 0; sleep_for = c)
00521     {
00522         <span class="keywordflow">if</span>((c = sleep(sleep_for)) == 0)
00523             <span class="keywordflow">break</span>;
00524         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(errno != EINTR)
00525             <span class="keywordflow">return</span> -1; <span class="comment">/* should never happen */</span>
00526     }
00527 
00528 <span class="preprocessor">#endif</span>
00529 <span class="preprocessor"></span>    <span class="keywordflow">return</span> 0;
00530 }
00531 
<a name="l00541"></a><a class="code" href="group__misc.html#ga20">00541</a> ssize_t <a class="code" href="group__misc.html#ga20">u_read</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t size)
00542 {
00543     ssize_t nw = 0;
00544     <span class="keywordtype">int</span> eof = 0;
00545 
00546     <span class="keywordflow">if</span>(<a class="code" href="group__misc.html#ga18">u_io</a>((iof_t) read, fd, buf, size, &amp;nw, &amp;eof))
00547     {
00548         <span class="keywordflow">if</span>(eof)
00549             <span class="keywordflow">return</span> nw; <span class="comment">/* may be zero */</span>
00550         <span class="keywordflow">else</span>
00551             <span class="keywordflow">return</span> -1;
00552     }
00553 
00554     <span class="keywordflow">return</span> nw;
00555 }
00556 
<a name="l00566"></a><a class="code" href="group__misc.html#ga21">00566</a> ssize_t <a class="code" href="group__misc.html#ga21">u_write</a>(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t size)
00567 {
00568     <span class="keywordflow">if</span>(<a class="code" href="group__misc.html#ga18">u_io</a>((iof_t) write, fd, buf, size, NULL, NULL))
00569         <span class="keywordflow">return</span> -1;
00570 
00571     <span class="keywordflow">return</span> size;
00572 }
00573 
<a name="l00575"></a><a class="code" href="group__misc.html#ga22">00575</a> <span class="keywordtype">int</span> <a class="code" href="group__misc.html#ga22">u_atoi</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *nptr, <span class="keywordtype">int</span> *pi)
00576 {
00577     <span class="keywordtype">long</span> <span class="keywordtype">int</span> tmp, saved_errno = errno;
00578 
00579     dbg_return_if (nptr == NULL, ~0);
00580     dbg_return_if (pi == NULL, ~0);
00581  
00582     tmp = strtol(nptr, (<span class="keywordtype">char</span> **) NULL, 10);
00583     
00584     dbg_err_if (tmp == 0 &amp;&amp; errno == EINVAL);
00585     dbg_err_if ((tmp == LONG_MIN || tmp == LONG_MAX) &amp;&amp; errno == ERANGE);
00586         
00587     *pi = (<span class="keywordtype">int</span>) tmp;
00588     
00589     errno = saved_errno;
00590     <span class="keywordflow">return</span> 0;
00591 err:
00592     errno = saved_errno;
00593     <span class="keywordflow">return</span> ~0;
00594 }
00595 
00596 <span class="preprocessor">#ifdef HAVE_STRTOUMAX</span>
00597 <span class="preprocessor"></span>
00598 <span class="keywordtype">int</span> u_atoumax (<span class="keyword">const</span> <span class="keywordtype">char</span> *nptr, uintmax_t *pumax)
00599 {
00600     uintmax_t tmp; 
00601     <span class="keywordtype">int</span> saved_errno = errno;
00602 
00603     dbg_return_if (nptr == NULL, ~0);
00604     dbg_return_if (pumax == NULL, ~0);
00605  
00606     tmp = strtoumax(nptr, (<span class="keywordtype">char</span> **) NULL, 10);
00607     
00608     dbg_err_if (tmp == 0 &amp;&amp; errno == EINVAL);
00609     dbg_err_if (tmp == UINTMAX_MAX &amp;&amp; errno == ERANGE);
00610         
00611     *pumax = tmp;
00612     
00613     errno = saved_errno;
00614     <span class="keywordflow">return</span> 0;
00615 err:
00616     errno = saved_errno;
00617     <span class="keywordflow">return</span> ~0;
00618 }
00619 <span class="preprocessor">#endif  </span><span class="comment">/* HAVE_STRTOUMAX */</span>
00620 
00621 <span class="keyword">inline</span> <span class="keywordtype">int</span> u_strlcpy(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t size)
00622 {
00623     <span class="keywordflow">return</span> (strlcpy(dst, src, size) &gt;= size ? ~0 : 0);
00624 }
00625 
00626 <span class="keyword">inline</span> <span class="keywordtype">int</span> u_strlcat(<span class="keywordtype">char</span> *dst, <span class="keyword">const</span> <span class="keywordtype">char</span> *src, size_t size)
00627 {
00628     <span class="keywordflow">return</span> (strlcat(dst, src, size) &gt;= size ? ~0 : 0);
00629 }
00630 
</pre></div><hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
