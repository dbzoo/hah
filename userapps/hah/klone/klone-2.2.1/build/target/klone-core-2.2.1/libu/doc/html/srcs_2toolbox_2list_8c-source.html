<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>LibU: list.c Source File</title>
<link href="kl.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a></div>
<h1>list.c</h1><div class="fragment"><pre>00001 <span class="comment">/* </span>
00002 <span class="comment"> * Copyright (c) 2005-2008 by KoanLogic s.r.l. - All rights reserved.  </span>
00003 <span class="comment"> */</span>
00004 
00005 <span class="preprocessor">#include &lt;u/libu_conf.h&gt;</span>
00006 <span class="preprocessor">#include &lt;u/libu.h&gt;</span>
00007 <span class="preprocessor">#include &lt;toolbox/list.h&gt;</span>
00008 
00009 <span class="keyword">typedef</span> <span class="keyword">struct </span>u_list_item_s
00010 {
00011     TAILQ_ENTRY(u_list_item_s) np;
00012     <span class="keywordtype">void</span> *ptr;
00013 } u_list_item_t;
00014 
00015 <span class="keyword">struct </span>u_list_s
00016 {
00017     TAILQ_HEAD(u_list_head_s, u_list_item_s) head;
00018     size_t count;
00019 };
00020 
<a name="l00033"></a><a class="code" href="group__list.html#ga0">00033</a> <span class="keywordtype">int</span> <a class="code" href="group__list.html#ga0">u_list_create</a>(u_list_t **plist)
00034 {
00035     u_list_t *list = NULL;
00036 
00037     list = <a class="code" href="group__alloc.html#ga6">u_zalloc</a>(<span class="keyword">sizeof</span>(u_list_t));
00038     dbg_err_if(list == NULL); 
00039 
00040     TAILQ_INIT(&amp;list-&gt;head);
00041 
00042     *plist = list;
00043 
00044     <span class="keywordflow">return</span> 0;
00045 err:
00046     <span class="keywordflow">if</span>(list)
00047         <a class="code" href="group__alloc.html#ga8">u_free</a>(list);
00048     <span class="keywordflow">return</span> ~0;
00049 }
00050 
<a name="l00059"></a><a class="code" href="group__list.html#ga1">00059</a> <span class="keywordtype">void</span> <a class="code" href="group__list.html#ga1">u_list_free</a>(u_list_t *list)
00060 {
00061     dbg_return_if(list == NULL, );
00062 
00063     <a class="code" href="group__list.html#ga10">u_list_clear</a>(list);
00064 
00065     <a class="code" href="group__alloc.html#ga8">u_free</a>(list);
00066 
00067     <span class="keywordflow">return</span>;
00068 }
00069 
<a name="l00078"></a><a class="code" href="group__list.html#ga2">00078</a> <span class="keywordtype">int</span> <a class="code" href="group__list.html#ga2">u_list_add</a>(u_list_t *list, <span class="keywordtype">void</span> *ptr)
00079 {
00080     <span class="keywordflow">return</span> <a class="code" href="group__list.html#ga6">u_list_insert</a>(list, ptr, list-&gt;count);
00081 }
00082 
<a name="l00091"></a><a class="code" href="group__list.html#ga3">00091</a> <span class="keywordtype">int</span> <a class="code" href="group__list.html#ga3">u_list_del</a>(u_list_t *list, <span class="keywordtype">void</span> *ptr)
00092 {
00093     u_list_item_t *item = NULL;
00094 
00095     TAILQ_FOREACH(item, &amp;list-&gt;head, np)
00096     {
00097         <span class="keywordflow">if</span>(item-&gt;ptr == ptr)
00098         {
00099             TAILQ_REMOVE(&amp;list-&gt;head, item, np);
00100             list-&gt;count--;
00101             <a class="code" href="group__alloc.html#ga8">u_free</a>(item);
00102             <span class="keywordflow">return</span> 0; <span class="comment">/* removed */</span>
00103         }
00104     }
00105 
00106     <span class="keywordflow">return</span> ~0; <span class="comment">/* not found */</span>
00107 }
00108 
<a name="l00116"></a><a class="code" href="group__list.html#ga4">00116</a> size_t <a class="code" href="group__list.html#ga4">u_list_count</a>(u_list_t *list)
00117 {
00118     <span class="comment">/* a SIGBUS is better than returning 0 if list == NULL */</span>
00119     <span class="keywordflow">return</span> list-&gt;count;
00120 }
00121 
<a name="l00131"></a><a class="code" href="group__list.html#ga5">00131</a> <span class="keywordtype">void</span>* <a class="code" href="group__list.html#ga5">u_list_get_n</a>(u_list_t *list, size_t n)
00132 {
00133     u_list_item_t *item = NULL;
00134 
00135     dbg_return_if (list == NULL, NULL);
00136     dbg_return_if (n &gt; list-&gt;count, NULL);
00137 
00138     TAILQ_FOREACH(item, &amp;list-&gt;head, np)
00139     {
00140         <span class="keywordflow">if</span>(n-- == 0)
00141             <span class="keywordflow">return</span> item-&gt;ptr;
00142     }
00143 
00144     <span class="keywordflow">return</span> NULL;
00145 }
00146 
<a name="l00156"></a><a class="code" href="group__list.html#ga6">00156</a> <span class="keywordtype">int</span> <a class="code" href="group__list.html#ga6">u_list_insert</a>(u_list_t *list, <span class="keywordtype">void</span> *ptr, size_t n)
00157 {
00158     u_list_item_t *prev, *item = NULL;
00159 
00160     dbg_return_if (list == NULL, ~0);
00161     dbg_return_if (n &gt; list-&gt;count, ~0);
00162 
00163     item = (u_list_item_t*)<a class="code" href="group__alloc.html#ga6">u_zalloc</a>(<span class="keyword">sizeof</span>(u_list_item_t));
00164     dbg_err_if(item == NULL);
00165 
00166     item-&gt;ptr = ptr;
00167             
00168     <span class="keywordflow">if</span>(n == 0)
00169     {
00170         TAILQ_INSERT_HEAD(&amp;list-&gt;head, item, np);
00171     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (n == list-&gt;count) {
00172         TAILQ_INSERT_TAIL(&amp;list-&gt;head, item, np);
00173     } <span class="keywordflow">else</span> {
00174         <span class="comment">/* find the current n-th elem */</span>
00175         TAILQ_FOREACH(prev, &amp;list-&gt;head, np)
00176         {
00177             <span class="keywordflow">if</span>(n-- == 0)
00178                 <span class="keywordflow">break</span>;
00179         }
00180 
00181         TAILQ_INSERT_BEFORE(prev, item, np);
00182     }
00183 
00184     list-&gt;count++;
00185 
00186     <span class="keywordflow">return</span> 0;
00187 err:
00188     <span class="keywordflow">if</span>(item)
00189         <a class="code" href="group__alloc.html#ga8">u_free</a>(item);
00190     <span class="keywordflow">return</span> ~0;
00191 }
00192 
<a name="l00201"></a><a class="code" href="group__list.html#ga7">00201</a> <span class="keywordtype">void</span>* <a class="code" href="group__list.html#ga7">u_list_first</a>(u_list_t *list, <span class="keywordtype">void</span> **it)
00202 {
00203     u_list_item_t *item;
00204 
00205     dbg_return_if (list == NULL, NULL);
00206 
00207     item = TAILQ_FIRST(&amp;list-&gt;head);
00208 
00209     <span class="keywordflow">if</span>(it &amp;&amp; item)
00210         *it = TAILQ_NEXT(item, np);
00211     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(it)
00212         *it = NULL;
00213 
00214     <span class="keywordflow">if</span>(item)
00215         <span class="keywordflow">return</span> item-&gt;ptr;
00216 
00217     <span class="keywordflow">return</span> NULL;
00218 }
00219 
<a name="l00237"></a><a class="code" href="group__list.html#ga8">00237</a> <span class="keywordtype">void</span>* <a class="code" href="group__list.html#ga8">u_list_next</a>(u_list_t *list, <span class="keywordtype">void</span> **it)
00238 {
00239     u_list_item_t *item;
00240 
00241     dbg_return_if (list == NULL, NULL);
00242     dbg_return_if (it == NULL, NULL);
00243     nop_return_if (*it == NULL, NULL);
00244 
00245     item = *it;
00246 
00247     <span class="keywordflow">if</span>(it &amp;&amp; item)
00248         *it = TAILQ_NEXT(item, np);
00249     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(it)
00250         *it = NULL;
00251 
00252     <span class="keywordflow">if</span>(item)
00253         <span class="keywordflow">return</span> item-&gt;ptr;
00254 
00255     <span class="keywordflow">return</span> NULL;
00256 }
00257 
<a name="l00267"></a><a class="code" href="group__list.html#ga9">00267</a> <span class="keywordtype">int</span> <a class="code" href="group__list.html#ga9">u_list_del_n</a>(u_list_t *list, size_t n, <span class="keywordtype">void</span> **pptr)
00268 {
00269     u_list_item_t *item = NULL;
00270 
00271     dbg_return_if (list == NULL, ~0);
00272     dbg_return_if (n &gt;= list-&gt;count, ~0);
00273 
00274     TAILQ_FOREACH(item, &amp;list-&gt;head, np)
00275     {
00276         <span class="keywordflow">if</span>(n-- == 0)
00277             <span class="keywordflow">break</span>;
00278     }
00279 
00280     <span class="keywordflow">if</span>(pptr)
00281         *pptr = item-&gt;ptr;
00282 
00283     TAILQ_REMOVE(&amp;list-&gt;head, item, np);
00284 
00285     list-&gt;count--;
00286 
00287     <a class="code" href="group__alloc.html#ga8">u_free</a>(item);
00288 
00289     <span class="keywordflow">return</span> 0;
00290 }
00291 
<a name="l00299"></a><a class="code" href="group__list.html#ga10">00299</a> <span class="keywordtype">int</span> <a class="code" href="group__list.html#ga10">u_list_clear</a>(u_list_t *list)
00300 {
00301     u_list_item_t *item;
00302 
00303     dbg_err_if(list == NULL);
00304 
00305     <span class="keywordflow">while</span>((item = TAILQ_FIRST(&amp;list-&gt;head)) != NULL)
00306     {
00307         TAILQ_REMOVE(&amp;list-&gt;head, item, np);
00308 
00309         <a class="code" href="group__alloc.html#ga8">u_free</a>(item);
00310     }
00311 
00312     <span class="keywordflow">return</span> 0;
00313 err:
00314     <span class="keywordflow">return</span> ~0;
00315 }
00316 
</pre></div><hr>
<div>
  <div style="text-align:left">
    <a href="http://www.koanlogic.com/kl/cont/gb/html/products.html">&larr;Products</a>
  </div>
  <div style="text-align:center;">
    &copy; 2005-2008 - <a href="http://www.koanlogic.com">KoanLogic S.r.l.</a> - All rights reserved
  </div>
</div>

</body>
</html>
